<div *ngIf="project" class="h-full bg-white p-4">
    <div *ngIf="informationSource" class="h-full">

        <div #stickyHeader class="pt-2 sticky -top-2 z-40 h-12">
            <div class="bg-white flex-grow " [ngClass]="isHeaderNormal?'':'shadow'">
                <div class="flex-row justify-start items-center inline-block" style="transition: all .25s ease-in-out;"
                    (dblclick)="openName(true,project.id)" [ngClass]="isHeaderNormal?'p-0':'flex py-2'">

                    <button [routerLink]="['../../heuristics']" class="text-green-800 text-sm font-medium">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 inline-block" fill="none"
                            viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                            <path stroke-linecap="round" stroke-linejoin="round" d="M7 16l-4-4m0 0l4-4m-4 4h18" />
                        </svg>
                        <span class="leading-5">Go back</span>
                    </button>

                    <div *ngIf="!isHeaderNormal" class="mx-4 text-sm leading-5 font-medium text-gray-500 inline-block">
                        {{informationSource.name}}</div>

                    <kern-heuristic-statuses [status]="status"></kern-heuristic-statuses>
                </div>
            </div>
        </div>

        <div class="overflow-x-hidden">
            <div class="grid gap-4 " [ngClass]="isHeaderNormal ? 'grid-cols-2' : 'grid-cols-1'">
                <div class="flex items-center mt-2" *ngIf="isHeaderNormal">
                    <button (click)="openName(true)" data-tip="Edit your heuristic's name"
                        class="tooltip tooltip-right flex-shrink-0 bg-white text-gray-700 text-xs font-semibold mr-3 px-4 py-2 rounded-md border border-gray-300 block float-left hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500">
                        Edit name
                    </button>

                    <div class="inline-block" (dblclick)="openName(true)" class="inline-flex w-full">
                        <ng-template [ngIf]="isNameOpen" [ngIfElse]="displayName">
                            <input #nameArea type="text" class="p-2 flex-grow input input-sm"
                                (input)="changeInformationSourceName($event)" (blur)="openName(false)"
                                (keydown.enter)="openName(false)" [(ngModel)]="informationSourceName">
                        </ng-template>

                        <ng-template #displayName>
                            <div class="mr-4 text-sm leading-5 font-medium text-gray-500 inline-block">
                                {{informationSource.name}}</div>
                        </ng-template>
                    </div>
                </div>

                <div class="flex items-center mt-2">
                    <button (click)="openDescription(true)" data-tip="Edit your heuristic's description"
                        class="tooltip tooltip-right flex-shrink-0 bg-white text-gray-700 text-xs font-semibold mr-3 px-4 py-2 rounded-md border border-gray-300 block float-left hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500">
                        Edit description
                    </button>
                    <div class="inline-block" (dblclick)="openDescription(true)" class="inline-flex w-full">
                        <ng-template [ngIf]="isDescriptionOpen" [ngIfElse]="displayDescription">
                            <input #descriptionArea type="text" class="p-2 flex-grow input input-sm"
                                (input)="openDescription($event)" (blur)="openDescription(false)"
                                (keydown.enter)="openDescription(false)" [(ngModel)]="description">
                        </ng-template>
                        <ng-template #displayDescription>
                            <div
                                class="font-normal text-gray-400 leading-9 text-sm flex-row justify-start items-center italic">
                                {{description}}
                            </div>
                        </ng-template>
                    </div>
                </div>
            </div>

            <div class="mt-8 text-sm text-gray-700 leading-5" *ngIf="zeroShotSettings">
                <div class="font-medium">Settings</div>
                <div class="font-normal mt-2">Labeling task</div>

                <div class="mt-1 flew-wrap relative">
                    <button type="button" data-tip="Select the labeling task"
                        class="tooltip tooltip-right inline-flex items-center justify-center rounded-md italic border border-gray-300 shadow-sm px-4 py-1.5 items-center bg-white text-xs font-semibold text-gray-700 cursor-pointer mr-5 focus:ring-offset-2 focus:ring-offset-gray-400"
                        id="menu-button" aria-expanded="true" aria-haspopup="true"
                        (isMenuOpen)="toggleVisible($event, labelTasks)" appDropdown>
                        {{ zeroShotSettings.taskId === null ? 'Select labeling task' :
                        labelingTasks.get(zeroShotSettings.taskId).name }}
                        <svg class="-mr-1 ml-2 h-5 w-5" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20"
                            fill="currentColor" aria-hidden="true">
                            <path fill-rule="evenodd"
                                d="M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z"
                                clip-rule="evenodd" />
                        </svg>
                    </button>
                    <div #labelTasks
                        class="origin-top-right absolute mt-2 w-56 rounded-md shadow-lg bg-white ring-1 ring-black ring-opacity-5 focus:outline-none hidden"
                        role="menu" aria-orientation="vertical" aria-labelledby="menu-button" tabindex="-1">
                        <div class="py-1 cursor-pointer" role="none">
                            <option *ngFor="let task of labelingTasksClassification" [ngValue]="task.id"
                                (click)="changeZeroShotSettings('taskId',task.id)"
                                class="text-gray-700 block px-4 py-1.5 text-xs hover:bg-gray-700 hover:text-white"
                                role="menuitem" tabindex="-1" id="menu-item-0">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24"
                                    stroke="currentColor" stroke-width="2">
                                    <path stroke-linecap="round" stroke-linejoin="round"
                                        d="M10 20l4-16m4 4l4 4-4 4M6 16l-4-4 4-4" />
                                </svg>
                                {{task.name }}
                            </option>
                        </div>
                    </div>

                    <div *ngIf="!labelingTasks.get(zeroShotSettings.taskId)?.labels.length"
                        class="font-normal text-gray-500 p-3 inline-block">
                        No labels for target task
                    </div>
                    <ng-container *ngFor="let label of labelingTasks.get(zeroShotSettings.taskId)?.labels">
                        <span (click)="changeZeroShotSettings('excludedLabels',label.id)"
                            [ngClass]="[getBackground(label.color), getText(label.color), getBorder(label.color), getHover(label.color)]"
                            class="inline-flex border items-center px-2 py-0.5 rounded text-xs font-medium cursor-pointer h-6 mr-5 my-2">
                            <span class="font-medium mr-3">{{label.name}}</span>
                            <span class="pb-0.5">
                                <input class="cursor-pointer align-middle" type="checkbox"
                                    [checked]="!zeroShotSettings.excludedLabels.includes(label.id)">
                            </span>
                        </span>
                    </ng-container>
                </div>

                <div class="mt-3 grid gap-x-4 gap-y-2 items-center"
                    style="grid-template-columns: max-content max-content max-content">
                    <div class="font-normal">Input attribute</div>
                    <div *ngIf="!isModelDownloading" class="font-normal inline-flex items-center" style="height: 24px;">
                        Model</div>
                    <div *ngIf="isModelDownloading" class="font-normal inline-flex items-center">Model Downloading
                        <kern-loading color="yellow"></kern-loading>
                    </div>
                    <div class="font-normal">Required model confidence</div>
                    <div class="relative tooltip tooltip-right" data-tip="Select the input attribute">
                        <button type="button"
                            class="inline-flex items-center justify-center rounded-md italic border border-gray-300 shadow-sm px-4 py-2 bg-white text-xs font-semibold text-gray-700 cursor-pointer focus:ring-offset-2 focus:ring-offset-gray-400"
                            id="menu-button" aria-expanded="true" aria-haspopup="true"
                            [disabled]="zeroShotSettings.attributeSelectDisabled"
                            [ngClass]="zeroShotSettings.attributeSelectDisabled ? 'opacity-50 cursor-not-allowed' : 'opacity-100 cursor-pointer'"
                            (isMenuOpen)="toggleVisible($event, inputAtt)" appDropdown>
                            {{ zeroShotSettings.attributeId === null ? 'Select input attribute' :
                            getAttributeName(zeroShotSettings.attributeId) }}
                            <svg class="-mr-1 ml-2 h-5 w-5" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20"
                                fill="currentColor" aria-hidden="true">
                                <path fill-rule="evenodd"
                                    d="M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z"
                                    clip-rule="evenodd" />
                            </svg>
                        </button>
                        <div #inputAtt
                            class="origin-top-right absolute mt-2 w-56 rounded-md shadow-lg bg-white ring-1 ring-black ring-opacity-5 focus:outline-none hidden"
                            role="menu" aria-orientation="vertical" aria-labelledby="menu-button" tabindex="-1">
                            <div class="py-1 cursor-pointer" role="none">
                                <option *ngFor="let att of textAttributes" [ngValue]="att.id"
                                    (click)="changeZeroShotSettings('attributeId',att.id)"
                                    class="text-gray-700 block px-4 py-2 text-xs hover:bg-gray-700 hover:text-white"
                                    role="menuitem" tabindex="-1" id="menu-item-0">
                                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none"
                                        viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                                        <path stroke-linecap="round" stroke-linejoin="round"
                                            d="M10 20l4-16m4 4l4 4-4 4M6 16l-4-4 4-4" />
                                    </svg>
                                    {{att.name }}
                                </option>
                            </div>
                        </div>
                    </div>
                    <div class="relative">
                        <button type="button" data-tip="Select the model"
                            class="tooltip tooltip-right inline-flex items-center justify-center rounded-md italic border border-gray-300 shadow-sm w-72 px-4 py-2 bg-white text-xs font-semibold text-gray-700 cursor-pointer focus:ring-offset-2 focus:ring-offset-gray-400"
                            id="menu-button" aria-expanded="true" aria-haspopup="true"
                            (isMenuOpen)="toggleVisible($event, model)" appDropdown>
                            {{ zeroShotSettings.targetConfig === null ? 'Select model' : zeroShotSettings.targetConfig
                            }}
                            <svg class="-mr-1 ml-2 h-5 w-5" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20"
                                fill="currentColor" aria-hidden="true">
                                <path fill-rule="evenodd"
                                    d="M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z"
                                    clip-rule="evenodd" />
                            </svg>
                        </button>
                        <div #model
                            class="origin-top-right absolute mt-2 rounded-md shadow-lg bg-white ring-1 ring-black ring-opacity-5 focus:outline-none hidden"
                            role="menu" aria-orientation="vertical" aria-labelledby="menu-button" tabindex="-1">
                            <div class="py-1 cursor-pointer" role="none">
                                <option *ngFor="let recommendation of zeroShotRecommendations"
                                    [ngValue]="recommendation.configString"
                                    (click)="changeZeroShotSettings('targetConfig',recommendation.configString)"
                                    class="text-gray-700 block px-4 py-2 text-xs hover:bg-gray-700 hover:text-white"
                                    role="menuitem" tabindex="-1" id="menu-item-0">
                                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none"
                                        viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                                        <path stroke-linecap="round" stroke-linejoin="round"
                                            d="M10 20l4-16m4 4l4 4-4 4M6 16l-4-4 4-4" />
                                    </svg>
                                    {{recommendation.configString }}
                                </option>
                            </div>
                        </div>
                    </div>
                    <div class="relative">
                        <button type="button" data-tip="Minimum confidence required to store predictions"
                            class="tooltip tooltip-right inline-flex items-center justify-center rounded-md italic border border-gray-300 shadow-sm w-20 px-4 py-2 bg-white text-xs font-semibold text-gray-700 cursor-pointer focus:ring-offset-2 focus:ring-offset-gray-400"
                            id="menu-button" aria-expanded="true" aria-haspopup="true"
                            (isMenuOpen)="toggleVisible($event, modelConfidence)" appDropdown>
                            {{ zeroShotSettings.minConfidence === null ? 'Select model' : zeroShotSettings.minConfidence
                            < 1 ? (zeroShotSettings.minConfidence*100).toFixed(0) + "%" :
                                (zeroShotSettings.minConfidence).toFixed(0) + "%" }} <svg class="-mr-1 ml-2 h-5 w-5"
                                xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor"
                                aria-hidden="true">
                                <path fill-rule="evenodd"
                                    d="M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z"
                                    clip-rule="evenodd" />
                                </svg>
                        </button>
                        <div #modelConfidence
                            class="origin-top-right absolute mt-2 rounded-md shadow-lg bg-white ring-1 ring-black ring-opacity-5 focus:outline-none hidden"
                            role="menu" aria-orientation="vertical" aria-labelledby="menu-button" tabindex="-1">
                            <div class="py-1 cursor-pointer" role="none">
                                <option *ngFor="let confidence of confidenceIntervals" [ngValue]="confidence"
                                    (click)="changeZeroShotSettings('minConfidence', confidence)"
                                    class="text-gray-700 block px-4 py-2 text-xs hover:bg-gray-700 hover:text-white"
                                    role="menuitem" tabindex="-1" id="menu-item-0">
                                    {{confidence}} %
                                </option>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="mt-8 text-sm leading-5">
                <div class="text-gray-700 font-medium mr-2">
                    Playground
                    <span class="text-gray-500 font-normal">
                        Zero-shot models take some time, so feel free to play around with it a bit before, during or
                        after
                        you run the heuristic.
                    </span>
                </div>

                <div>
                    <input #testInput placeholder="Enter any text..."
                        class="input input-sm input-bordered placeholder-italic w-full" (focus)="$event.target.select()"
                        (keydown.enter)="runZeroShotTest(testInput.value.trim())">
                </div>


                <div class="flex flex-row items-center mt-2">
                    <span class="text-sm leading-10 text-gray-500 font-normal mr-3">
                        By default we use the labels from your selected task. You can also switch them on or off.
                    </span>

                    <input #customLabels type="text"
                        placeholder="You can test with different labels by inserting them here. Separate them by comma"
                        class="input input-sm input-bordered placeholder-italic flex-grow mr-2"
                        (focus)="$event.target.select()">

                    <div class="w-8">
                        <div data-tip="Why is this taking so long?" class="tooltip">
                            <label for="why-so-long" class="cursor-pointer">
                                <div [ngClass]="testerRequestedSomething?null:'hidden'">
                                    <kern-loading color="indigo"></kern-loading>
                                </div>
                            </label>
                        </div>
                        <input type="checkbox" id="why-so-long" class="modal-toggle">
                        <div class="modal">
                            <div class="modal-box text-black bg-white justify-center text-center">
                                <h1 class="text-lg text-gray-900 mb-2">Why is this taking so long?</h1>
                                <div class="text-sm text-gray-500 my-2">
                                    Zero shot modules take a lot of time. That's unfortunate but nothing problematic.
                                    However, if the test center takes longer than expected usually the reason is that
                                    the
                                    underlying
                                    models needs
                                    to be prepared. But fear not! This is a task that only needs to be done once.
                                </div>
                                <div class="modal-action">
                                    <label for="why-so-long"
                                        class="bg-white text-gray-700 text-xs font-semibold mr-4 px-4 py-2 rounded border border-gray-300 cursor-pointer hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 inline-block">Close</label>
                                </div>
                            </div>
                        </div>
                    </div>
                    <button [disabled]="testerRequestedSomething"
                        data-tip="Computes the prediction for your given example text"
                        [ngClass]="testerRequestedSomething ? 'opacity-50 cursor-not-allowed' : 'opacity-100 cursor-pointer'"
                        class="tooltip tooltip-left ml-3 bg-indigo-700 text-white text-xs leading-4 font-medium px-4 py-2 rounded-md border cursor-pointer hover:bg-indigo-800 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500"
                        (click)="runZeroShotTest(testInput.value.trim())">
                        Compute example
                    </button>
                </div>


                <div *ngIf="singleLineTesterResult?.length" class="mt-2 text-sm leading-5">
                    <span class="text-gray-700 font-semibold">Prediction</span>
                    <div class="grid gap-x-2 items-center "
                        style="grid-template-columns: max-content 16.5rem max-content;">
                        <div class="contents" *ngFor="let result of singleLineTesterResult;let i=index">
                            <div *ngIf="labelColor.get(zeroShotSettings.taskId)?.get(result.labelName) as color; else otherLabel"
                                [ngClass]="[getBackground(color), getText(color), getBorder(color), getHover(color)]"
                                class="border items-center px-2 py-0.5 rounded text-xs font-medium text-center m-2">
                                {{result.labelName}}
                            </div>
                            <ng-template #otherLabel>
                                <div
                                    class="border items-center px-2 py-0.5 rounded text-xs font-medium text-center m-2 bg-gray-100 text-gray-700 border-gray-400 hover:bg-gray-200">
                                    {{result.labelName}}
                                </div>
                            </ng-template>
                            <progress class="progress progress-primary w-64" [value]="result.confidence"
                                max="1"></progress>
                            <div class="flex flex-row items-center">
                                <span class="text-sm select-none self-start mr-2">{{result.confidenceText}}</span>
                                <div *ngIf="i==0 && result.confidence < zeroShotSettings.minConfidence"
                                    data-tip="< minConfidence -> would be ignored" class="tooltip">
                                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none"
                                        viewBox="0 0 24 24" stroke="#eab700" stroke-width="2">
                                        <path stroke-linecap="round" stroke-linejoin="round"
                                            d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
                                    </svg>
                                </div>
                            </div>

                        </div>
                    </div>
                </div>
            </div>

            <div class="mt-8 text-sm leading-5">
                <div class="text-gray-700 font-medium mr-2">
                    Execution
                </div>

                <div class="grid items-center" style="grid-template-columns: auto max-content 0px 0px;">
                    <div class="text-gray-500 font-normal">You can execute your model
                        on all records, or test-run it on 10 examples (which are sampled randomly). Test results are
                        shown
                        below after computation.</div>
                    <div>
                        <div [ngClass]="testerRequestedSomething?null:'hidden'" class="inline-block">
                            <kern-loading color="indigo"></kern-loading>
                        </div>
                        <button [disabled]="testerRequestedSomething" data-tip="Execute the model on 10 records"
                            [ngClass]="testerRequestedSomething ? 'opacity-50 cursor-not-allowed' : 'opacity-100 cursor-pointer'"
                            (click)="runZeroShot10RecordTest()"
                            class="tooltip tooltip-left bg-white text-gray-700 text-xs font-semibold px-4 py-2 rounded-md border border-gray-300 hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500">
                            Run on 10
                        </button>
                        <button [disabled]="!canRunProject" data-tip="Execute the model on all records"
                            [ngClass]="!canRunProject ? 'opacity-50 cursor-not-allowed' : 'opacity-100 cursor-pointer'"
                            (click)="runZeroShotProject()"
                            class="z-40 tooltip tooltip-left bg-indigo-700 text-white text-xs leading-4 font-semibold px-4 py-2 rounded-md cursor-pointer ml-3 hover:bg-indigo-800 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500">
                            Run
                        </button>
                    </div>
                </div>
            </div>

            <div *ngIf="randomRecordTesterResult" class="mt-4 flex flex-col">
                <div class="overflow-x-auto">
                    <div class="inline-block min-w-full align-middle">
                        <div class="overflow-hidden shadow ring-1 ring-black ring-opacity-5 md:rounded-lg">
                            <table class="min-w-full border divide-y divide-gray-300">
                                <div class="divide-y divide-gray-200 bg-white"
                                    *ngFor="let record of randomRecordTesterResult.records">
                                    <div *ngIf="record.labels.length"
                                        class="flex-shrink-0 border-b border-gray-200 shadow-sm flex justify-between items-center">
                                        <div
                                            class="flex items-center text-xs leading-5 text-gray-500 font-normal text-center ml-4 my-3 text-left">
                                            {{record.checkedText}}
                                        </div>
                                        <div class="flex flex-row flex-nowrap items-center my-3 grid"
                                            style="grid-template-columns: auto 40px 40px 80px;">
                                            <div class="flex items-center justify-center mr-5">
                                                <span
                                                    *ngIf="labelColor.get(zeroShotSettings.taskId)?.get(record.labels[0].labelName) as color; else otherLabel"
                                                    [ngClass]="[getBackground(color), getText(color), getBorder(color), getHover(color)]"
                                                    class="inline-flex items-center px-2 py-0.5 rounded text-xs font-medium border">
                                                    {{record.labels[0].labelName}}{{record.labels[0].id}}
                                                </span>
                                                <ng-template #otherLabel>
                                                    <div
                                                        class="border items-center px-2 py-0.5 rounded text-xs font-medium text-center m-2 bg-gray-100 text-gray-700 border-gray-400 hover:bg-gray-200">
                                                        {{record.labels[0].labelName}}
                                                    </div>
                                                </ng-template>
                                            </div>
                                            <div class="flex items-center justify-center">
                                                <span class="text-xs leading-5 text-gray-500 font-normal text-center">
                                                    {{record.labels[0].confidenceText}}
                                                </span>
                                            </div>
                                            <div class="flex items-center justify-center">
                                                <div *ngIf="(record.labels[0].confidence*100) < zeroShotSettings.minConfidence"
                                                    data-tip="< minConfidence -> would be ignored"
                                                    class="tooltip tooltip-left mx-1">
                                                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none"
                                                        viewBox="0 0 24 24" stroke="#eab700" stroke-width="2">
                                                        <path stroke-linecap="round" stroke-linejoin="round"
                                                            d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
                                                    </svg>
                                                </div>
                                            </div>
                                            <div class="flex items-center justify-center mr-5">
                                                <label [for]="'zero-shot-'+record.recordId"
                                                    class="text-xs bg-white text-gray-700 text-xs font-semibold px-4 py-1 rounded border border-gray-300 cursor-pointer hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 inline-block">
                                                    View
                                                </label>
                                            </div>
                                        </div>
                                        <input type="checkbox" [id]="'zero-shot-'+record.recordId" class="modal-toggle">
                                        <div class="modal text-center items-center">
                                            <div class="modal-box" style="max-width: 48rem;">
                                                <h1 class="text-lg text-gray-900 mb-2">View details</h1>
                                                <div class="text-sm text-gray-500 my-2"
                                                    class="overflow-y-auto max-height-modal">
                                                    <div *ngFor="let att of attributes"
                                                        class="text-sm leading-5 text-left my-3">
                                                        <div class="text-gray-900 font-medium">{{att.name}}</div>
                                                        <div class="text-gray-500 font-normal">
                                                            {{record.fullRecordData[att.name]}}</div>
                                                    </div>

                                                    <div class="grid gap-x-2 items-center"
                                                        style="grid-template-columns: max-content 16.5rem max-content;">
                                                        <div class="contents" *ngFor="let result of record.labels">
                                                            <div *ngIf="labelColor.get(zeroShotSettings.taskId)?.get(result.labelName) as color; else otherLabel"
                                                                [ngClass]="[getBackground(color), getText(color), getBorder(color), getHover(color)]"
                                                                class="border items-center px-2 py-0.5 rounded text-xs font-medium text-center m-2">
                                                                {{result.labelName}}
                                                            </div>
                                                            <ng-template #otherLabel>
                                                                <div
                                                                    class="border items-center px-2 py-0.5 rounded text-xs font-medium text-center m-2 bg-gray-100 text-gray-700 border-gray-400 hover:bg-gray-200">
                                                                    {{result.labelName}}
                                                                </div>
                                                            </ng-template>
                                                            <progress class="progress progress-primary w-64"
                                                                [value]="result.confidence" max="1"></progress>
                                                            <div class="flex flex-row items-center">
                                                                <span
                                                                    class="text-sm select-none">{{result.confidenceText}}</span>
                                                                <div *ngIf="i==0 && result.confidence < zeroShotSettings.minConfidence"
                                                                    data-tip="< minConfidence -> would be ignored"
                                                                    class="tooltip">
                                                                    <svg xmlns="http://www.w3.org/2000/svg"
                                                                        class="h-5 w-5" fill="none" viewBox="0 0 24 24"
                                                                        stroke="#eab700" stroke-width="2">
                                                                        <path stroke-linecap="round"
                                                                            stroke-linejoin="round"
                                                                            d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
                                                                    </svg>
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>

                                                <div class="modal-action text-center">
                                                    <label [for]="'zero-shot-'+record.recordId"
                                                        class="bg-white text-gray-700 text-xs font-semibold mr-4 px-4 py-2 rounded border border-gray-300 cursor-pointer hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 inline-block">Close</label>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </table>
                        </div>
                    </div>
                </div>
            </div>


            <div class="mt-8">
                <div class="text-sm leading-5 font-medium text-gray-700 inline-block">Statistics</div>
                <div class="mt-1 flex flex-col">
                    <div class="-my-2 -mx-4 overflow-x-auto sm:-mx-6 lg:-mx-8">
                        <div class="inline-block min-w-full py-2 align-middle md:px-6 lg:px-8">
                            <div class="overflow-hidden shadow ring-1 ring-black ring-opacity-5 md:rounded-lg">
                                <table class="min-w-full border divide-y divide-gray-300">
                                    <thead class="bg-gray-50">
                                        <tr>
                                            <th scope="col"
                                                class="py-2 pl-4 pr-3 text-left text-xs font-medium uppercase tracking-wide text-gray-500 sm:pl-6">
                                                Label</th>
                                            <th scope="col"
                                                class="px-3 py-2 text-center text-xs font-medium uppercase tracking-wide text-gray-500">
                                                <span class="tooltip-text-smaller tooltip tooltip-right"
                                                    data-tip="True positives / (True positives + False positives) for the reference data you labeled">Est.
                                                    Precision</span>
                                            </th>
                                            <th *ngIf="informationSource.returnType == 'YIELD'" scope="col"
                                                class="px-3 py-2 text-center text-xs font-medium uppercase tracking-wide text-gray-500">
                                                <span class="tooltip-text-smaller tooltip tooltip-right"
                                                    data-tip="True positives / (True positives + False negatives) for the reference data you labeled">Est.
                                                    Recall</span>
                                            </th>
                                            <th scope="col"
                                                class="px-3 py-2 text-center text-xs font-medium uppercase tracking-wide text-gray-500">
                                                <span class="tooltip-text-smaller tooltip tooltip-left"
                                                    data-tip="How many records does this heuristic generally hit?">Coverage</span>
                                            </th>
                                            <th scope="col"
                                                class="px-3 py-2 text-center text-xs font-medium uppercase tracking-wide text-gray-500">
                                                <span class="tooltip-text-no-margin tooltip tooltip-left"
                                                    data-tip="How many spans are hit by this heuristic?">Hits</span>
                                            </th>
                                            <th scope="col"
                                                class="px-3 py-2 text-center text-xs font-medium uppercase tracking-wide text-gray-500">
                                                <span class="tooltip-text-bigger tooltip tooltip-left"
                                                    data-tip="On how many records (or spans) does this heuristic create conflicting expressions to other heuristics?">Conflicts</span>
                                            </th>
                                            <th scope="col"
                                                class="px-3 py-2 text-center text-xs font-medium uppercase tracking-wide text-gray-500">
                                                <span class="tooltip-text-bigger tooltip tooltip-left"
                                                    data-tip="On how many records (or spans) does this heuristic create overlapping expressions to other heuristics?">Overlaps</span>
                                            </th>
                                        </tr>
                                    </thead>
                                    <tbody class="divide-y divide-gray-200">
                                        <tr *ngFor="let sourceContainer of informationSource.stats; let j = index"
                                            [ngClass]="j%2!=0 ? 'bg-gray-50':'bg-white'">
                                            <td
                                                class="whitespace-nowrap py-2 pl-4 pr-3 text-sm font-medium text-gray-900 sm:pl-6">
                                                <span
                                                    [ngClass]="[getBackground(sourceContainer.color), getText(sourceContainer.color), getBorder(sourceContainer.color), getHover(sourceContainer.color)]"
                                                    class="inline-flex items-center px-2 py-0.5 rounded text-xs font-medium border">
                                                    {{sourceContainer.label}}
                                                </span>
                                            </td>
                                            <td class="whitespace-nowrap text-center px-3 py-2 text-sm text-gray-500">
                                                {{sourceContainer.values.Precision | percentRound: 2}}
                                            </td>
                                            <td *ngIf="informationSource.returnType == 'YIELD'"
                                                class="whitespace-nowrap text-center px-3 py-2 text-sm text-gray-500">
                                                {{sourceContainer.values.Recall | percentRound: 2}}
                                            </td>
                                            <td class="whitespace-nowrap text-center px-3 py-2 text-sm text-gray-500">
                                                {{sourceContainer.values.Coverage}}
                                            </td>
                                            <td class="whitespace-nowrap text-center px-3 py-2 text-sm text-gray-500">
                                                {{sourceContainer.values.TotalHits}}
                                            </td>
                                            <td class="whitespace-nowrap text-center px-3 py-2 text-sm text-gray-500">
                                                {{sourceContainer.values.Conflicts}}
                                            </td>
                                            <td class="whitespace-nowrap text-center px-3 py-2 text-sm text-gray-500">
                                                {{sourceContainer.values.Overlaps}}
                                            </td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="mt-8">
                <div class="text-sm leading-5 font-medium text-gray-700 inline-block">Last execution</div>
                <div *ngIf="!informationSource.lastTask" class="bg-white">
                    <div class="py-6 text-sm leading-5 font-normal text-gray-500">This
                        {{getInformationSourceTypeString(informationSource.informationSourceType)}} was not yet run.
                    </div>
                </div>
                <div *ngIf="informationSource.lastTask as task"
                    class="mb-4 card shadow bg-white flex-grow overflow-visible">
                    <div class="card-body p-6">
                        <div class="flex flex-row justify-between items-center">
                            <div class="flex flex-grow items-center">
                                <div *ngIf="task.state === 'CREATED'" data-tip="Currently being executed."
                                    class="tooltip tooltip-right relative z-10">
                                    <kern-loading></kern-loading>
                                </div>
                                <div *ngIf="task.state === 'FINISHED'" data-tip="Successfully executed."
                                    class="tooltip tooltip-right">
                                    <div class="btn cursor-default btn-circle btn-xs no-animation btn-primary mx-2">
                                        <svg xmlns="http://www.w3.org/2000/svg"
                                            class="inline-block w-4 h-4 stroke-current" fill="none" viewBox="0 0 24 24"
                                            stroke="currentColor">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                                d="M5 13l4 4L19 7" />
                                        </svg>
                                    </div>
                                </div>
                                <div *ngIf="task.state === 'FAILED'" data-tip="Execution ran into errors."
                                    class="tooltip tooltip-right">
                                    <div class="btn cursor-default btn-circle btn-xs no-animation btn-error mx-2">
                                        <svg xmlns="http://www.w3.org/2000/svg"
                                            class="inline-block w-4 h-4 stroke-current" fill="none" viewBox="0 0 24 24"
                                            stroke="currentColor">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                                d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z" />
                                        </svg>
                                    </div>
                                </div>

                                <div class="text-sm leading-5 font-normal text-gray-500">run#{{task.iteration}}</div>
                                <progress *ngIf="task.state === 'CREATED'" class="progress progress-info w-full m-2"
                                    [value]="task.progress" max="1"></progress>

                                <div data-tip="execution time" class="tooltip">
                                    <div *ngIf="task.durationText"
                                        class="text-sm leading-5 font-normal text-gray-500 ml-2 select-none">
                                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 inline-block -mt-0.5"
                                            viewBox="0 0 20 20" fill="currentColor">
                                            <path fill-rule="evenodd"
                                                d="M10.293 5.293a1 1 0 011.414 0l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414-1.414L12.586 11H5a1 1 0 110-2h7.586l-2.293-2.293a1 1 0 010-1.414z"
                                                clip-rule="evenodd" />
                                        </svg>
                                        <span class="ml-2">{{task.durationText}}</span>
                                    </div>
                                </div>
                            </div>
                            <div class="flex">
                                <div class="text-sm leading-5 font-normal text-gray-500">{{parseUTC(task.createdAt)}}
                                </div>
                            </div>
                        </div>

                    </div>
                </div>
            </div>

            <div class="mt-8 pb-8">
                <div class="text-gray-900 text-lg leading-6 font-medium">Danger zone</div>
                <div class="text-sm leading-5 font-normal mt-2 text-gray-500 inline-block">This action can not be
                    reversed.
                    Are you sure you want to delete this heuristic?</div>

                <div data-tip="This can't be reverted!" class="tooltip tooltip-right">
                    <label [for]="'delete-modal-'+informationSource.id"
                        class="bg-red-100 text-red-700 border border-red-400 text-xs font-semibold px-4 py-2 rounded-md cursor-pointer ml-6 h-9 hover:bg-red-200 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500">
                        Delete zero_shot
                    </label>
                </div>
                <input type="checkbox" [id]="'delete-modal-'+informationSource.id" class="modal-toggle">
                <div class="modal text-center items-center">
                    <div class="modal-box">
                        <h1 class="text-lg text-gray-900 mb-2">Delete heuristic</h1>
                        <div class="text-sm text-gray-500 my-2">
                            Are you sure you want to delete this heuristic?
                        </div>

                        <div class="modal-action text-center">
                            <label [for]="'delete-modal-'+informationSource.id"
                                class="bg-red-100 text-red-700 border border-red-400 text-xs font-semibold mr-2 px-4 py-2 rounded flex cursor-pointer hover:bg-red-200 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500 inline-block"
                                [routerLink]="['../../heuristics']"
                                (click)="deleteInformationSource(project.id, informationSource.id)">Delete</label>
                            <label [for]="'delete-modal-'+informationSource.id"
                                class="bg-white text-gray-700 text-xs font-semibold mr-4 px-4 py-2 rounded border border-gray-300 cursor-pointer hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 inline-block">Close</label>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>