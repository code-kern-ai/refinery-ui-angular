<div *ngIf="project$ | async as project" class="flex flex-row h-full">
    <!--sidebar-->
    <div class="bg-white flex-auto h-full w-full overflow-hidden transition_all sidebar_width seperator_right"
        [ngClass]="isSearchMenuOpen?'sidebar_width_open ':null">
        <div class="flex flex-col select-none p-4 sidebar_width_open overflow-y-auto h-full"
            [ngClass]="isSearchMenuVisible? 'search_menu_width':null">
            <div class="flex flex-row items-center">
                <ng-template [ngIf]="isSearchMenuOpen">
                    <div class="pr-3 bg-white text-lg font-medium text-gray-900">Existing filters</div>
                </ng-template>
                <div #menuOpener class="cursor-pointer" (click)="openSearchMenu(menuOpener)">
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-layout-sidebar"
                        width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none"
                        stroke-linecap="round" stroke-linejoin="round">
                        <path stroke="none" d="M0 0h24v24H0z" fill="none"></path>
                        <rect x="4" y="4" width="16" height="16" rx="2"></rect>
                        <line x1="9" y1="4" x2="9" y2="20"></line>
                    </svg>
                </div>
            </div>
            <div *ngIf="isSearchMenuOpen || isSearchMenuVisible" class="transition_all opacity-0"
                [ngClass]="isSearchMenuVisible&&isSearchMenuOpen?'opacity-100':null">
                <div class="text-sm text-gray-400">You can filter and order all your data in the browser according
                    to your needs. Selected filter criteria can be saved and used later on.
                    <!-- Also, you can choose
                        a preset below -->
                    <div data-tip="Outdated slice&#10;save to update" class="tooltip ml-2">
                        <div class="flex justify-center items-center w-full h-full relative -mt-2" style="top:6px"
                            [ngClass]="{hidden:activeSlice?.sliceType == SliceTypes.STATIC_OUTLIER || !(displayOutdatedWarning  || (activeSlice?.static && staticDataSliceCurrentCount!=null && activeSlice.count!=staticDataSliceCurrentCount))}">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24"
                                stroke="currentColor" stroke-width="2">
                                <path stroke-linecap="round" stroke-linejoin="round"
                                    d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z" />
                            </svg>
                        </div>
                    </div>
                </div>

                <div class="mt-2" [ngClass]="this.sliceNames.size > 6 ? null : 'hidden'">
                    <input type="text" placeholder="enter name to filter" [(ngModel)]="dataSliceFilter"
                        (ngModelChange)="filterAvailableSlices()" class="w-full input input-sm input-bordered p-2">

                </div>
                <input #saveInputCheckbox type="checkbox" id="save-slice-modal" class="modal-toggle"
                    (change)="focusModalInputBox($event,'dataSliceName')">
                <div class="modal">
                    <div class="modal-box text-black bg-white justify-center">
                        <div class="flex flex-grow justify-center text-lg leading-6 text-gray-900 font-medium">
                            Filter creation</div>
                        <div class="mb-2 flex flex-grow justify-center text-sm">
                            Save or update a filter for the data browser.</div>
                        <p class="pt-4">You have two choices.
                            <label class="block font-bold mt-2">Dynamic:</label>
                            Stores the current filter critera and is reapplied whenever the slice is
                            selected.<br><br>
                            <label class="block font-bold mt-2 ">Static:</label>
                            Used for visualization filters and scope of
                            work for annotators & domain experts.
                            Stores the current records provided by your filter.
                            These are limited to 10,000 records and can be refreshed if nessecary.
                        </p>
                        <div class="mt-2">
                            <div class="flex">
                                <div class="inline-flex">
                                    <div class="form-control">
                                        <label class="cursor-pointer label">
                                            <span class="label-text mr-1">Dynamic</span>
                                            <input #inputDynamic type="radio"
                                                style="--focus-shadow:none;accent-color:rgb(29,78,216)"
                                                (click)="setStatic(inputDynamic,inputStatic,false)"
                                                class="h-4 w-4 border-gray-200 cursor-pointer" checked [value]="true">
                                        </label>
                                    </div>
                                    <div class="form-control">
                                        <label class="cursor-pointer label">
                                            <span class="label-text mr-1">Static</span>
                                            <input #inputStatic type="radio"
                                                style="--focus-shadow:none;accent-color:rgb(180,83,9)"
                                                (click)="setStatic(inputDynamic,inputStatic,true)"
                                                class="h-4 w-4 border-gray-200 cursor-pointer" [value]="false">
                                        </label>
                                    </div>
                                </div>
                                <div data-tip="Too many records for a static slice" class="relative tooltip mr-1"
                                    style="white-space: break-spaces;">
                                    <div class="flex justify-center items-center w-full h-full"
                                        [ngClass]="{hidden:!displayStaticNotAllowedWarning}">
                                        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none"
                                            viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                                            <path fill="#E8CD20" stroke-linecap="round" stroke-linejoin="round"
                                                d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z" />
                                        </svg>
                                    </div>
                                </div>
                            </div>
                            <div class="flex w-full justify-between mt-2">
                                <input #inputSliceName type="text" class="w-1/2 input input-bordered input-sm"
                                    placeholder="Enter name" name="dataSliceName"
                                    (keyup)="checkNameExists(inputSliceName.value)"
                                    (keydown.enter)="saveInputCheckbox.checked=false;sliceNameExists ? updateSliceByName(inputSliceName.value):createSlice(inputSliceName.value)">
                                <div>
                                    <label for="save-slice-modal"
                                        class="bg-green-100 text-green-700 border border-green-400 text-xs font-semibold px-4 py-2 mr-2 rounded-md cursor-pointer hover:bg-green-200 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-green-500"
                                        (click)="sliceNameExists? updateSliceByName(inputSliceName.value):createSlice(inputSliceName.value)">{{sliceNameExists?
                                        'Update filter':'Save filter'}}</label>

                                    <label for="save-slice-modal"
                                        class="bg-white text-gray-700 text-xs font-semibold mr-4 px-4 py-2 rounded border border-gray-300 cursor-pointer hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 inline-block">Close</label>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="mt-2 mb-4" *ngIf="dataSlices">
                    <div *ngIf="dataSlices.length > 0">
                        <button (click)="toggleSlice(dataSlice);"
                            class="cursor-pointer mr-1 mb-1 inline-flex items-center justify-between px-2.5 py-1.5 border border-gray-200 shadow-sm text-sm font-medium rounded text-gray-700 bg-white slice-width hover:bg-gray-50 focus:outline-none"
                            *ngFor="let dataSlice of dataSlices" [ngClass]="getBorderStyle(dataSlice)"
                            [ngClass]="{'hidden':filteredSliceIds.has(dataSlice.id),'ring-2 ring-blue-500':activeSlice == dataSlice}">

                            <label class="cursor-pointer mr-2" for="slice-information"
                                (click)="updateSliceInfo(dataSlice.id);$event.stopPropagation()">
                                <svg class="h-5 w-5 rounded-full stroke-0" xmlns="http://www.w3.org/2000/svg"
                                    viewBox="0 0 20 20" [ngStyle]="dataSlice.sliceType==SliceTypes.STATIC_OUTLIER?{background: 'rgb(77,124,15)', fill: 'rgb(236,252,203)'}:
                                    dataSlice.sliceType==SliceTypes.STATIC_DEFAULT?{background: 'rgb(180,83,9)', fill: 'rgb(254,243,199)'}:
                                    {background: 'rgb(29,78,216)', fill: 'rgb(219,234,254)'}" fill="currentColor"
                                    aria-hidden="true">
                                    <path fill-rule="evenodd"
                                        d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z"
                                        clip-rule="evenodd" />
                                </svg>
                            </label>
                            <label class="text-gray-700 truncate label-max-width cursor-pointer"
                                [ngClass]="dataSlice.sliceType == SliceTypes.STATIC_OUTLIER?'text-xs whitespace-pre':'text-sm'">{{
                                dataSlice.sliceType != SliceTypes.STATIC_OUTLIER ?
                                dataSlice.name : parseUTC(dataSlice.createdAt,true) }}</label>

                            <div (click)="deleteSlice(dataSlice.id);$event.stopPropagation();" class="">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 ml-2 text-red-700" fill="none"
                                    viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                                    <path stroke-linecap="round" stroke-linejoin="round"
                                        d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" />
                                </svg>
                            </div>
                        </button>
                    </div>

                </div>

                <div class="relative">
                    <div class="absolute inset-0 flex items-center">
                        <div class="w-full border-t border-gray-300"></div>
                    </div>
                    <div class="relative flex justify-start">
                        <span class="pr-3 bg-white text-lg font-medium text-gray-900">Filter</span>
                    </div>
                </div>

                <!--Dynamic Search Groups-->
                <ng-template [ngIf]="searchGroups">

                    <ng-template ngFor let-group [ngForOf]="searchGroupOrder">

                        <div class="mt-4">

                            <!-- Group header-->
                            <div #searchGroup [name]="group.key"
                                class="flex flex-row items-center transition_transform rounded-md hover:bg-gray-50 cursor-pointer"
                                (click)="toggleGroupMenu(group.key, searchGroup)">
                                <div class="w-7">
                                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none"
                                        viewBox="0 0 24 24" stroke="currentColor">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                            d="M19 9l-7 7-7-7" />
                                    </svg>
                                </div>
                                <div class="flex flex-col">
                                    <div class="font-bold truncate" style="max-width: 21rem;">
                                        {{searchGroups.get(group.key).name}}<label
                                            *ngIf="searchGroups.get(group.key).nameAdd !=''"
                                            class="font-normal ml-2">{{searchGroups.get(group.key).nameAdd}}</label>
                                    </div>
                                    <div class="text-xs text-gray-400 truncate" style="max-width: 21rem;">
                                        {{searchGroups.get(group.key).subText}}<label
                                            *ngIf="searchGroups.get(group.key).nameAdd !=''"
                                            class="font-normal ml-1">{{searchGroups.get(group.key).nameAdd}}</label>
                                    </div>
                                </div>
                            </div>
                            <!-- Group items -->
                            <div #searchGroupItems class="transition_all ml-4"
                                [ngClass]="!searchGroups.get(group.key).isOpen || searchGroups.get(group.key).inOpenTransition?'overflow-hidden':null"
                                [style.max-height]="searchGroups.get(group.key).isOpen?searchGroupItems.scrollHeight +'px':'0px'">
                                <form [formGroup]="fullSearch.get(group.key)">
                                    <div formArrayName="groupElements">

                                        <ng-template ngFor let-groupItem
                                            [ngForOf]="getSearchFormArray(group.key).controls" let-i="index">
                                            <!--groupItem.get('id').value.toString()-->
                                            <div [formGroupName]="i" class="contents mx-2">

                                                <container-element [ngSwitch]="groupItem.get('group').value">
                                                    <ng-template ngSwitchDefault>
                                                        <p>
                                                            {{'Default :('}}
                                                        </p>
                                                    </ng-template>
                                                    <ng-template [ngSwitchCase]="SearchGroupType.ATTRIBUTES">
                                                        <div
                                                            class="flex flex-row items-center rounded-md hover:bg-gray-50 mt-2">
                                                            <div class="flex flex-col">
                                                                <div class="ml-2 mr-2 h-4 w-4 border-gray-300 border rounded cursor-pointer hover:bg-gray-200"
                                                                    (click)="setActiveNegateGroup(groupItem)"
                                                                    [ngStyle]="{'background-color':getActiveNegateGroupColor(groupItem), 'border-color':getActiveNegateGroupColor(groupItem)}">
                                                                </div>
                                                                <div *ngIf="getSearchFormArray(group.key).controls.length > 1"
                                                                    (click)="removeSearchGroupItem(groupItem.get('groupKey').value, groupItem.get('id').value)"
                                                                    class="cursor-pointer btn hover:border-transparent hover:bg-transparent border-transparent bg-transparent btn-xs px-0"
                                                                    style="margin-top:.2rem">
                                                                    <svg xmlns="http://www.w3.org/2000/svg"
                                                                        class="text-black inline-block w-4 h-4 stroke-current"
                                                                        fill="none" viewBox="0 0 24 24"
                                                                        stroke="currentColor">
                                                                        <path stroke-linecap="round"
                                                                            stroke-linejoin="round" stroke-width="2"
                                                                            d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" />
                                                                    </svg>
                                                                </div>
                                                            </div>
                                                            <div class="flex-grow mr-2 flex flex-col  mt-2 ">
                                                                <div class="flex-grow flex flex-row flex-wrap gap-1">
                                                                    <select formControlName="name"
                                                                        class="font-dmMono flex-grow select select-sm select-bordered">
                                                                        <option value="Any Attribute">Any Attribute
                                                                        </option>
                                                                        <option
                                                                            *ngFor="let attribute of attributesSortOrder"
                                                                            [value]="attributes.get(attribute.key).name">
                                                                            {{attributes.get(attribute.key).name }}
                                                                        </option>
                                                                    </select>
                                                                    <select formControlName="operator"
                                                                        class="font-dmMono select select-sm select-bordered">
                                                                        <option
                                                                            *ngFor="let dropdown of getOperatorDropdownValues()"
                                                                            [value]="dropdown.value">
                                                                            {{dropdown.value }}
                                                                        </option>
                                                                    </select>
                                                                </div>

                                                                <div class="my-2 flex-grow">
                                                                    <input formControlName="searchValue" type="text"
                                                                        [placeholder]="groupItem.get('addText').value"
                                                                        class="w-full input input-sm input-bordered">
                                                                </div>
                                                            </div>

                                                        </div>
                                                        <div class="w-full flex justify-center">
                                                            <ng-template
                                                                [ngIf]="i==getSearchFormArray(group.key).controls.length-1">
                                                                <label
                                                                    class="inline-flex items-center px-0.5 py-0.5 border border-gray-200 shadow-sm text-xs font-medium rounded text-gray-700 bg-white focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 cursor-pointer"
                                                                    (click)="addSearchGroupItem(groupItem, searchGroupItems)">
                                                                    <div>
                                                                        <svg xmlns="http://www.w3.org/2000/svg"
                                                                            class="h-5 w-5" fill="none"
                                                                            viewBox="0 0 24 24" stroke="currentColor">
                                                                            <path stroke-linecap="round"
                                                                                stroke-linejoin="round" stroke-width="2"
                                                                                d="M12 4v16m8-8H4" />
                                                                        </svg>
                                                                    </div>
                                                                </label>
                                                            </ng-template>
                                                        </div>
                                                    </ng-template>
                                                    <ng-template [ngSwitchCase]="SearchGroupType.USER_FILTER">
                                                        <div class="flex flex-row items-center mt-4">
                                                            <div class="flex-grow flex">
                                                                <div class="flex flex-col">
                                                                    <div *ngFor="let user of groupItem.get('users').controls; let k = index"
                                                                        class="my-1">
                                                                        <div
                                                                            class="form-control flex flex-row flex-nowrap">
                                                                            <label formArrayName="users"
                                                                                (click)="setActiveNegateGroup(user)"
                                                                                class="label p-0 search_reduced_item_width flex justify-start items-center">
                                                                                <div class="mr-2 h-4 w-4 border-gray-300 border rounded cursor-pointer hover:bg-gray-200"
                                                                                    [ngStyle]="{'background-color':getActiveNegateGroupColor(user), 'border-color':getActiveNegateGroupColor(user)}">
                                                                                </div>
                                                                                <span
                                                                                    class="label-text truncate">{{user.get("displayName").value}}
                                                                                </span>
                                                                            </label>
                                                                            <div
                                                                                *ngIf="userFilter.userMap.get(user.get('id').value) as userM">
                                                                                <div [attr.data-tip]="user.get('dataTip').value"
                                                                                    class="tooltip tooltip-left">
                                                                                    <label class="cursor-pointer"
                                                                                        for="user-info"
                                                                                        (click)="userFilter.currentUserInfo = userM">
                                                                                        <svg xmlns="http://www.w3.org/2000/svg"
                                                                                            class="h-4 w-4" fill="none"
                                                                                            viewBox="0 0 24 24"
                                                                                            stroke="currentColor"
                                                                                            stroke-width="2">
                                                                                            <path stroke-linecap="round"
                                                                                                stroke-linejoin="round"
                                                                                                d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
                                                                                        </svg>
                                                                                    </label>

                                                                                </div>
                                                                            </div>
                                                                        </div>
                                                                    </div>
                                                                </div>

                                                            </div>
                                                        </div>

                                                    </ng-template>
                                                    <ng-template [ngSwitchCase]="SearchGroupType.LABELING_TASKS">
                                                        <div class="flex flex-row items-center mt-4">
                                                            <div class="flex-grow flex flex-col ">

                                                                <div>Manually labeled</div>
                                                                <div class="flex-grow min-w-0">
                                                                    <div class="dropdown">
                                                                        <ng-template
                                                                            [ngIf]="groupItem.get('manualLabels').controls.length == 0"
                                                                            [ngIfElse]="dropDownML">
                                                                            <ng-container
                                                                                [ngTemplateOutlet]="buttonLabelsDisabled">
                                                                            </ng-container>
                                                                        </ng-template>
                                                                        <ng-template #dropDownML>
                                                                            <kern-dropdown [dropdownOptions]="{
                                                                                optionArray:groupItem.get('manualLabels').controls,
                                                                                hasCheckboxes:true,
                                                                                keepDropdownOpen:true
                                                                            }"
                                                                                (optionClicked)="setActiveNegateGroup($event)">
                                                                            </kern-dropdown>
                                                                        </ng-template>
                                                                    </div>
                                                                </div>
                                                                <div>
                                                                    <div class="mt-2">Weakly supervised</div>
                                                                    <div class="flex-grow min-w-0">
                                                                        <div class="dropdown">
                                                                            <ng-template
                                                                                [ngIf]="groupItem.get('weakSupervisionLabels').controls.length == 0"
                                                                                formArrayName="manualLabels"
                                                                                [ngIfElse]="dropDownWS">
                                                                                <ng-container
                                                                                    [ngTemplateOutlet]="buttonLabelsDisabled">
                                                                                </ng-container>
                                                                            </ng-template>
                                                                            <ng-template #dropDownWS>
                                                                                <kern-dropdown [dropdownOptions]="{
                                                                                optionArray:groupItem.get('weakSupervisionLabels').controls,
                                                                                hasCheckboxes:true,
                                                                                keepDropdownOpen:true
                                                                            }" (optionClicked)="setActiveNegateGroup($event)">
                                                                                </kern-dropdown>
                                                                            </ng-template>
                                                                        </div>
                                                                    </div>
                                                                    <div class="flex-grow min-w-0 mt-1">
                                                                        <div class="flex flex-row items-center"
                                                                            [formGroup]="groupItem.get('weakSupervisionConfidence')">
                                                                            <span
                                                                                class="label-text mr-1 font-dmMono">CONFIDENCE
                                                                                BETWEEN</span><input
                                                                                formControlName="lower" type="number"
                                                                                class="w-12 px-2 input input-sm input-bordered"
                                                                                (blur)="ensureValidConfidence(groupItem.get('weakSupervisionConfidence'))">
                                                                            <span class="label-text mx-1 font-dmMono">%
                                                                                AND</span>
                                                                            <input formControlName="upper" type="number"
                                                                                class="w-12 input input-sm input-bordered px-2"
                                                                                (blur)="ensureValidConfidence(groupItem.get('weakSupervisionConfidence'))">
                                                                            <span
                                                                                class="label-text mx-1 font-dmMono">%</span>
                                                                        </div>
                                                                    </div>
                                                                </div>
                                                                <div>
                                                                    <div class="mt-2">Model callback</div>
                                                                    <div class="flex-grow min-w-0">
                                                                        <div class="dropdown">
                                                                            <ng-template
                                                                                [ngIf]="groupItem.get('modelCallbackLabels').controls.length == 0"
                                                                                formArrayName="manualLabels"
                                                                                [ngIfElse]="dropDownMC">
                                                                                <ng-container
                                                                                    [ngTemplateOutlet]="buttonLabelsDisabled">
                                                                                </ng-container>
                                                                            </ng-template>
                                                                            <ng-template #dropDownMC>
                                                                                <kern-dropdown [dropdownOptions]="{
                                                                                optionArray:groupItem.get('modelCallbackLabels').controls,
                                                                                hasCheckboxes:true,
                                                                                keepDropdownOpen:true
                                                                            }" (optionClicked)="setActiveNegateGroup($event)">
                                                                                </kern-dropdown>
                                                                            </ng-template>
                                                                        </div>
                                                                    </div>
                                                                    <div class="flex-grow min-w-0 mt-1">
                                                                        <div class="flex flex-row items-center"
                                                                            [formGroup]="groupItem.get('modelCallbackConfidence')">
                                                                            <span
                                                                                class="label-text mr-1 font-dmMono">CONFIDENCE
                                                                                BETWEEN</span><input
                                                                                formControlName="lower" type="number"
                                                                                class="w-12 px-2 input input-sm input-bordered"
                                                                                (blur)="ensureValidConfidence(groupItem.get('modelCallbackConfidence'))">
                                                                            <span class="label-text mx-1 font-dmMono">%
                                                                                AND</span>
                                                                            <input formControlName="upper" type="number"
                                                                                class="w-12 input input-sm input-bordered px-2"
                                                                                (blur)="ensureValidConfidence(groupItem.get('modelCallbackConfidence'))">
                                                                            <span
                                                                                class="label-text mx-1 font-dmMono">%</span>
                                                                        </div>
                                                                    </div>
                                                                </div>
                                                                <div class="mt-2 font-bold">Heuristics
                                                                </div>
                                                                <div>
                                                                    <ng-template
                                                                        [ngIf]="groupItem.get('informationSources').controls.length == 0"
                                                                        [ngIfElse]="functionBlock">
                                                                        <div class="text-sm text-gray-400">No
                                                                            Heuristics associated with this
                                                                            task</div>
                                                                    </ng-template>
                                                                    <ng-template #functionBlock>
                                                                        <div class="flex flex-col">
                                                                            <div
                                                                                class="seperator_bottom seperator_top py-2 mt-1">
                                                                                <div class="form-control">
                                                                                    <label
                                                                                        [formGroup]="groupItem.get('isWithDifferentResults')"
                                                                                        class="cursor-pointer label p-0 search_reduced_item_width"
                                                                                        (click)="setActiveNegateGroup(groupItem.get('isWithDifferentResults'))">
                                                                                        <div class="h-4 w-4 border-gray-300 border rounded hover:bg-gray-200"
                                                                                            [ngStyle]="{'background-color':getActiveNegateGroupColor(groupItem.get('isWithDifferentResults'))}">
                                                                                        </div>
                                                                                        <span
                                                                                            class="label-text truncate w-full pl-2">Only
                                                                                            with different
                                                                                            results</span>
                                                                                    </label>
                                                                                </div>

                                                                            </div>
                                                                            <div
                                                                                *ngFor="let lf of groupItem.get('informationSources').controls; let k = index">
                                                                                <div class="form-control mt-2">
                                                                                    <label
                                                                                        formArrayName="informationSources"
                                                                                        class="label p-0 search_reduced_item_width cursor-pointer"
                                                                                        (click)="setActiveNegateGroup(lf)">
                                                                                        <div class="h-4 w-4 border-gray-300 border rounded hover:bg-gray-200"
                                                                                            [ngStyle]="{'background-color':getActiveNegateGroupColor(lf), 'border-color':getActiveNegateGroupColor(lf)}">
                                                                                        </div>
                                                                                        <span
                                                                                            class="label-text truncate w-full pl-2">{{lf.get("name").value}}</span>
                                                                                    </label>
                                                                                </div>
                                                                            </div>
                                                                        </div>
                                                                    </ng-template>
                                                                </div>

                                                            </div>
                                                        </div>

                                                    </ng-template>
                                                    <ng-template [ngSwitchCase]="SearchGroupType.ORDER_STATEMENTS">
                                                        <div class="mt-4">
                                                            <div
                                                                *ngFor="let sortItem of groupItem.get('orderBy').controls; let k = index">
                                                                <div class="form-control class mb-2">
                                                                    <label
                                                                        *ngIf="sortItem.get('orderByKey').value != StaticOrderByKeysType.RANDOM"
                                                                        class="cursor-pointer label p-0 search_reduced_item_width"
                                                                        [ngClass]="sortItem.get('direction').value == 1?'rotate_transform':null"
                                                                        (click)="setSortForControl(sortItem)">
                                                                        <div
                                                                            class="h-4 w-4 border-gray-300 border rounded cursor-pointer hover:bg-gray-200">
                                                                            <ng-template
                                                                                [ngIf]="sortItem.get('active').value != 0">
                                                                                <svg xmlns="http://www.w3.org/2000/svg"
                                                                                    class="block" fill="none"
                                                                                    viewBox="0 0 24 24"
                                                                                    stroke="currentColor">
                                                                                    <path stroke-linecap="round"
                                                                                        stroke-linejoin="round"
                                                                                        stroke-width="2"
                                                                                        d="M17 13l-5 5m0 0l-5-5m5 5V6" />
                                                                                </svg>
                                                                            </ng-template>
                                                                        </div>
                                                                        <span
                                                                            class="ml-2 label-text truncate w-full">{{sortItem.get("displayName").value}}</span>
                                                                    </label>
                                                                    <div *ngIf="sortItem.get('orderByKey').value == StaticOrderByKeysType.RANDOM"
                                                                        [formGroup]="sortItem"
                                                                        class="flex flex-row items-center mr-2">
                                                                        <label class="label p-0 ">
                                                                            <div class="h-4 w-4 border-gray-300 border rounded cursor-pointer hover:bg-gray-200"
                                                                                (click)="setActiveNegateGroup(sortItem)"
                                                                                [ngStyle]="{'background-color':getActiveNegateGroupColor(sortItem), 'border-color':getActiveNegateGroupColor(sortItem)}">
                                                                            </div>
                                                                            <span
                                                                                class="label-text ml-1">{{sortItem.get("displayName").value}}</span>
                                                                        </label>
                                                                        <div class="flex rounded-md shadow-sm">
                                                                            <span
                                                                                class="ml-2 inline-flex items-center px-2.5 text-sm rounded-l-md border border-r-0 border-gray-300 bg-gray-50 text-gray-500 sm:text-sm">
                                                                                Seed
                                                                                <div (click)="generateRandomSeed(sortItem)"
                                                                                    class="ml-2 cursor-pointer">
                                                                                    <svg xmlns="http://www.w3.org/2000/svg"
                                                                                        class="icon icon-tabler icon-tabler-arrows-random"
                                                                                        width="18" height="18"
                                                                                        viewBox="0 0 24 24"
                                                                                        stroke-width="2"
                                                                                        stroke="currentColor"
                                                                                        fill="none"
                                                                                        stroke-linecap="round"
                                                                                        stroke-linejoin="round">
                                                                                        <path stroke="none"
                                                                                            d="M0 0h24v24H0z"
                                                                                            fill="none"></path>
                                                                                        <path d="M20 21.004h-4v-4">
                                                                                        </path>
                                                                                        <path d="M16 21.004l5 -5">
                                                                                        </path>
                                                                                        <path
                                                                                            d="M6.5 9.504l-3.5 -2l2 -3.504">
                                                                                        </path>
                                                                                        <path d="M3 7.504l6.83 -1.87">
                                                                                        </path>
                                                                                        <path d="M4 16.004l4 -1l1 4">
                                                                                        </path>
                                                                                        <path d="M8 15.004l-3.5 6">
                                                                                        </path>
                                                                                        <path
                                                                                            d="M21 5.004l-.5 4l-4 -.5">
                                                                                        </path>
                                                                                        <path d="M20.5 9.004l-4.5 -5.5">
                                                                                        </path>
                                                                                    </svg>
                                                                                </div>
                                                                            </span>
                                                                            <input formControlName="seedString"
                                                                                (focus)="$event.target.select()"
                                                                                class="w-36 input input-sm flex-1 min-w-0 block px-3 py-2 rounded-none rounded-r-md border border-0 border-gray-300 text-gray-500 sm:text-sm">
                                                                        </div>
                                                                    </div>
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </ng-template>
                                                </container-element>
                                            </div>
                                        </ng-template>
                                    </div>
                                </form>
                            </div>
                        </div>
                    </ng-template>
                </ng-template>

                <div class="mt-4 grid items-center"
                    style="grid-template-columns: max-content max-content max-content max-content max-content;">
                    <div *ngIf="fullSearch?.get('DRILL_DOWN')" class="contents">
                        <form [formGroup]="fullSearch.get('DRILL_DOWN')" class="contents flex items-center">
                            <div data-tip="Connection within atomic filters"
                                class="tooltip tooltip-right relative z-50">
                                <div class="cursor-help mr-2 underline"
                                    style="text-decoration-style: dotted;text-underline-offset: 2px;text-decoration-color: #22c55e">
                                    Connect by
                                </div>
                            </div>
                            <div class="flex items-center">
                                <input id="radio-drill-down-inactive" type="radio" formControlName="DRILL_DOWN"
                                    class="focus:ring-blue-500 h-4 w-4 text-blue-600 border-gray-200" [value]="false">
                                <label for="radio-drill-down-inactive"
                                    class="cursor-pointer label p-1 label-text pr-2 font-dmMono">
                                    OR
                                </label>
                            </div>
                            <div class="flex items-center mr-3">
                                <input id="radio-drill-down-active" type="radio" formControlName="DRILL_DOWN" checked
                                    class="focus:ring-blue-500 h-4 w-4 text-blue-600 border-gray-200" [value]="true">
                                <label for="radio-drill-down-active"
                                    class="cursor-pointer label p-1 label-text pr-2 font-dmMono">
                                    AND
                                </label>
                            </div>
                        </form>
                    </div>
                </div>

                <div class="flex items-center mt-4">
                    <div data-tip="Store filters to disk" class="tooltip tooltip-top relative"
                        [ngClass]="similarSearchHelper.recordsInDisplay || activeSlide ? 'cursor-not-allowed':'' ">
                        <label for="save-slice-modal"
                            class="mr-1 inline-flex items-center w-32 px-2.5 py-1.5 border border-gray-200 shadow-sm text-xs font-medium rounded text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 cursor-pointer"
                            [ngClass]="similarSearchHelper.recordsInDisplay || activeSlide ? 'opacity-50 cursor-not-allowed pointer-events-none' : 'opacity-100 cursor-pointer'"
                            [ngStyle]="similarSearchHelper.recordsInDisplay || activeSlide ? {'background-color': '#f9fafb','cursor': 'not-allowed'} : null">
                            <svg xmlns="http://www.w3.org/2000/svg" class="mr-2 icon icon-tabler icon-tabler-filter"
                                width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor"
                                fill="none" stroke-linecap="round" stroke-linejoin="round">
                                <path stroke="none" d="M0 0h24v24H0z" fill="none"></path>
                                <path d="M5.5 5h13a1 1 0 0 1 .5 1.5l-5 5.5l0 7l-4 -3l0 -4l-5 -5.5a1 1 0 0 1 .5 -1.5">
                                </path>
                            </svg>
                            Save filter
                        </label>
                    </div>
                    <div>
                        <div data-tip="Update your current filter" class="tooltip tooltip-top relative"
                            [ngClass]="updateButton.disabled ? 'cursor-not-allowed':'' ">
                            <button #updateButton
                                class="mr-1 inline-flex items-center w-32 px-2.5 py-1.5 border border-gray-200 shadow-sm text-xs font-medium rounded text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 cursor-pointer"
                                (click)="updateSlice()"
                                [disabled]="!activeSlice || activeSlice?.sliceType == SliceTypes.STATIC_OUTLIER || (activeSlice?.static && activeSlice.count==staticDataSliceCurrentCount && !displayOutdatedWarning)"
                                [ngClass]="updateButton.disabled ? 'opacity-50 cursor-not-allowed pointer-events-none' : 'opacity-100 cursor-pointer'"
                                [ngStyle]="updateButton.disabled && {'background-color': '#f9fafb','cursor': 'not-allowed'}">
                                <svg xmlns="http://www.w3.org/2000/svg"
                                    class="mr-2 icon icon-tabler icon-tabler-rotate-2" width="24" height="24"
                                    viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none"
                                    stroke-linecap="round" stroke-linejoin="round">
                                    <path stroke="none" d="M0 0h24v24H0z" fill="none"></path>
                                    <path d="M15 4.55a8 8 0 0 0 -6 14.9m0 -4.45v5h-5"></path>
                                    <line x1="18.37" y1="7.16" x2="18.37" y2="7.17"></line>
                                    <line x1="13" y1="19.94" x2="13" y2="19.95"></line>
                                    <line x1="16.84" y1="18.37" x2="16.84" y2="18.38"></line>
                                    <line x1="19.37" y1="15.1" x2="19.37" y2="15.11"></line>
                                    <line x1="19.94" y1="11" x2="19.94" y2="11.01"></line>
                                </svg>
                                Update filter
                            </button>
                        </div>
                    </div>
                </div>
                <div class="mt-1">
                    <div data-tip="Creates a static slices" class="tooltip tooltip-bottom relative"
                        [ngClass]="!(similarSearchHelper.embeddings?.length && anyRecordManuallyLabeled) ? 'cursor-not-allowed' : ''">
                        <label [for]="similarSearchHelper.embeddings?.length > 1?'outlier-search-embedding-select':''"
                            (click)="similarSearchHelper.embeddings?.length==1?requestOutlierSlice(similarSearchHelper.embeddings[0].id):null"
                            [ngClass]="!(similarSearchHelper.embeddings?.length && anyRecordManuallyLabeled) ? 'opacity-50 cursor-not-allowed pointer-events-none' : 'opacity-100 cursor-pointer' "
                            class="text-green-800 text-sm font-medium">
                            <span
                                class="mr-1 inline-flex items-center w-32 px-2.5 py-1.5 border border-gray-200 shadow-sm text-xs font-medium rounded text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500">
                                <svg xmlns="http://www.w3.org/2000/svg"
                                    style="stroke: rgba(77,124,15); fill: rgba(236,252,203);"
                                    class="mr-2 icon icon-tabler icon-tabler-chart-bubble" width="24" height="24"
                                    viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none"
                                    stroke-linecap="round" stroke-linejoin="round">
                                    <path stroke="none" d="M0 0h24v24H0z" fill="none"></path>
                                    <circle cx="6" cy="16" r="3"></circle>
                                    <circle cx="16" cy="19" r="2"></circle>
                                    <circle cx="14.5" cy="7.5" r="4.5"></circle>
                                </svg>
                                Find outliers
                            </span>
                        </label>
                    </div>
                    <ng-template [ngIf]="similarSearchHelper.embeddings?.length>1">
                        <input type="checkbox" id="outlier-search-embedding-select" class="modal-toggle">
                        <div class="modal" *ngIf="similarSearchHelper.embeddings?.length>1">
                            <div class="modal-box text-black bg-white justify-center">
                                <div class="flex flex-grow justify-center text-lg leading-6 text-gray-900 font-medium">
                                    Select embedding for outlier search </div>
                                <div *ngIf="activeSearchParams.length > 0 || similarSearchHelper.recordsInDisplay">
                                    <div class="text-red-500 mb-2 flex flex-grow justify-center text-sm">
                                        Warning: your current filter selection will be removed!</div>
                                </div>
                                <select #embeddingSelect class="select select-bordered select-sm w-full mt-4">
                                    <option *ngFor="let embedding of similarSearchHelper.embeddings"
                                        [value]="embedding.id">
                                        {{embedding.name }}
                                    </option>
                                </select>
                                <div class="modal-action">
                                    <label for="outlier-search-embedding-select"
                                        class="mr-2 bg-green-100 text-green-700 border border-green-400 text-xs font-semibold px-4 py-2 rounded-md cursor-pointer hover:bg-green-200 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-green-500"
                                        (click)="requestOutlierSlice(similarSearchHelper.embeddings[embeddingSelect.selectedIndex].id)">Build</label>
                                    <label for="outlier-search-embedding-select"
                                        class="bg-white text-gray-700 text-xs font-semibold mr-4 px-4 py-2 rounded border border-gray-300 cursor-pointer hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 inline-block">Close</label>
                                </div>
                            </div>
                        </div>
                    </ng-template>
                    <ng-template [ngIf]="similarSearchHelper.embeddings?.length>1">
                        <input type="checkbox" id="outlier-slice-embedding-select" class="modal-toggle">
                        <div class="modal" *ngIf="similarSearchHelper.embeddings?.length>1">
                            <div class="modal-box text-black bg-white justify-center">
                                <div class="flex flex-grow justify-center mb-4 font-bold">
                                    Select corresponding embedding
                                </div>
                                <select #embeddingSelect class="select select-bordered select-sm w-full">
                                    <option *ngFor="let embedding of similarSearchHelper.embeddings"
                                        [value]="embedding.id">
                                        {{embedding.name }}
                                    </option>
                                </select>
                                <div class="modal-action">
                                    <label for="outlier-slice-embedding-select"
                                        class="bg-green-100 text-green-700 border border-green-400 text-xs font-semibold px-4 py-2 rounded-md cursor-pointer hover:bg-green-200 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-green-500"
                                        (click)="requestOutlierSlice(similarSearchHelper.embeddings[embeddingSelect.selectedIndex].id)">Create</label>
                                    <label for="outlier-slice-embedding-select"
                                        class="bg-white text-gray-700 text-xs font-semibold mr-4 px-4 py-2 rounded border border-gray-300 cursor-pointer hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 inline-block">Close</label>
                                </div>
                            </div>
                        </div>
                    </ng-template>
                </div>
            </div>
        </div>

    </div>
    <!-- Main Page-->
    <div class="pt-4 bg-gray-100 flex-auto flex flex-col px-2 h-full transition_all"
        [ngClass]="isSearchMenuOpen || isSearchMenuVisible?'main_page_width_open':'main_page_width'">

        <!--Search header-->
        <div class="flex items-center justify-between">
            <ng-template [ngIf]="extendedRecords">
                <div>
                    <ng-template [ngIf]="extendedRecords.sql">
                        <label for="displaySQL" class="modal-button cursor-pointer">
                            <ng-container [ngTemplateOutlet]="countDisplay">
                            </ng-container>
                        </label>
                        <input type="checkbox" id="displaySQL" class="modal-toggle">
                        <div class="modal">
                            <div class="modal-box text-black bg-white justify-center"
                                style="max-width: 80%; width:fit-content;height:fit-content;max-height: 90%;">
                                <div class="flex flex-grow justify-center">
                                    <div data-tip="Copy to clipboard" class="tooltip">
                                        <div class="cursor-pointer" (click)="copyToClipboard(extendedRecords.sql)">
                                            Info
                                        </div>
                                    </div>
                                </div>
                                <pre class="mt-6 text-left"
                                    style="white-space: pre-wrap; overflow: auto; max-height: 700px; ">{{extendedRecords.sql}}</pre>
                                <div class="modal-action">
                                    <label for="displaySQL"
                                        class="bg-white text-gray-700 text-xs font-semibold mr-4 px-4 py-2 rounded border border-gray-300 cursor-pointer hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 inline-block">Close</label>
                                </div>
                            </div>
                        </div>
                    </ng-template>
                    <ng-template [ngIf]="!extendedRecords.sql">
                        <ng-container [ngTemplateOutlet]="countDisplay">
                        </ng-container>
                    </ng-template>
                </div>

            </ng-template>
            <ng-template #countDisplay>
                <div class="text-sm select-none flex flex-row flex-nowrap whitespace-nowrap mr-2">
                    {{extendedRecords.fullCount
                    | number}}
                    Record{{extendedRecords.fullCount ===
                    1
                    ? '' : 's'}}
                    <div *ngIf="activeSlice?.static && activeSlice.count!=staticDataSliceCurrentCount"
                        class="tooltip tooltip-bottom"
                        [attr.data-tip]="'The count displayed is provided by the slice.&#10;The backend holds '+staticDataSliceCurrentCount +' Records with the same filter critera'"
                        style="white-space: break-spaces;">
                        <div>*</div>
                    </div>
                </div>
            </ng-template>
            <div class="mr-3 flex justify-center">
                <ng-template [ngIf]="activeSlice?.static || similarSearchHelper.recordsInDisplay">
                    <div class="flex flex-col items-center rounded-md border border-yellow-500 mr-2 select-none">
                        <ng-template #staticWarning [ngIf]="activeSlice?.static" [ngIfElse]="similarWarning">
                            <div class="rounded-md bg-yellow-50 p-2">
                                <div class="flex items-center">
                                    <div class="flex-shrink-0">
                                        <svg class="h-5 w-5 text-yellow-400" xmlns="http://www.w3.org/2000/svg"
                                            viewBox="0 0 20 20" fill="currentColor" aria-hidden="true">
                                            <path fill-rule="evenodd"
                                                d="M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z"
                                                clip-rule="evenodd" />
                                        </svg>
                                    </div>
                                    <div class="ml-3">
                                        <p class="text-sm font-medium text-yellow-800">Static filter active. Filter
                                            changes won't take effect{{activeSlice?.sliceType !=
                                            SliceTypes.STATIC_OUTLIER ? ' until you update the slice':''}}.</p>
                                        <div *ngIf="staticSliceOrderActive && activeSlice?.sliceType != SliceTypes.STATIC_OUTLIER"
                                            class="text-xs font-medium text-yellow-800">
                                            * Result order still takes effect: {{staticSliceOrderActive}}</div>
                                    </div>
                                </div>
                            </div>
                        </ng-template>
                        <ng-template #similarWarning>
                            <div class="rounded-md bg-yellow-50 p-2">
                                <div class="flex">
                                    <div class="flex-shrink-0">
                                        <svg class="h-5 w-5 text-yellow-400" xmlns="http://www.w3.org/2000/svg"
                                            viewBox="0 0 20 20" fill="currentColor" aria-hidden="true">
                                            <path fill-rule="evenodd"
                                                d="M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z"
                                                clip-rule="evenodd" />
                                        </svg>
                                    </div>
                                    <div class="ml-3">
                                        <p class="text-sm font-medium text-yellow-800">Similarity search active. Filter
                                            changes will replace search results.</p>
                                    </div>
                                </div>
                            </div>
                        </ng-template>
                    </div>
                </ng-template>
                <div class="flex items-center">
                    <button *ngIf="activeSlice || activeSearchParams.length > 0 || similarSearchHelper.recordsInDisplay"
                        class="mr-1 inline-flex items-center px-2.5 py-1.5 border border-gray-200 shadow-sm text-xs font-medium rounded text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 cursor-pointer"
                        (click)="clearFilters()">
                        <svg xmlns="http://www.w3.org/2000/svg" class="mr-2 icon icon-tabler icon-tabler-filter-off"
                            width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor"
                            fill="none" stroke-linecap="round" stroke-linejoin="round">
                            <path stroke="none" d="M0 0h24v24H0z" fill="none"></path>
                            <line x1="3" y1="3" x2="21" y2="21"></line>
                            <path
                                d="M9 5h9.5a1 1 0 0 1 .5 1.5l-4.049 4.454m-.951 3.046v5l-4 -3v-4l-5 -5.5a1 1 0 0 1 .18 -1.316">
                            </path>
                        </svg>
                        Clear filter
                    </button>
                </div>

                <div data-tip="Change the data browser configurations"
                    class="tooltip tooltip-left relative flex items-center">
                    <label for="config-modal"
                        class=" opacity-100 cursor-pointer mr-1 inline-flex items-center px-2.5 py-1.5 border border-gray-200 shadow-sm text-xs font-medium rounded text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 cursor-pointer">
                        <svg xmlns="http://www.w3.org/2000/svg"
                            class="mr-2 icon icon-tabler icon-tabler-adjustments inline-block" width="20" height="20"
                            viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none"
                            stroke-linecap="round" stroke-linejoin="round">
                            <path stroke="none" d="M0 0h24v24H0z" fill="none"></path>
                            <circle cx="6" cy="10" r="2"></circle>
                            <line x1="6" y1="4" x2="6" y2="8"></line>
                            <line x1="6" y1="12" x2="6" y2="20"></line>
                            <circle cx="12" cy="16" r="2"></circle>
                            <line x1="12" y1="4" x2="12" y2="14"></line>
                            <line x1="12" y1="18" x2="12" y2="20"></line>
                            <circle cx="18" cy="7" r="2"></circle>
                            <line x1="18" y1="4" x2="18" y2="5"></line>
                            <line x1="18" y1="9" x2="18" y2="20"></line>
                        </svg>
                        Configuration
                    </label>
                </div>
                <input #saveInputCheckbox type="checkbox" id="config-modal" class="modal-toggle"
                    (change)="focusModalInputBox($event,'config')">
                <div class="modal">
                    <div class="modal-box text-black bg-white justify-center">
                        <div class="flex flex-grow justify-center text-lg leading-6 text-gray-900 font-medium">
                            View configuration </div>
                        <div class="mb-2 flex flex-grow justify-center text-sm">
                            Change the content that is displayed in the browser.</div>
                        <div class="mb-2">
                            <fieldset class="space-y-5">
                                <div class="relative flex items-start">
                                    <div class="flex items-center h-5">
                                        <input id="comments" type="checkbox"
                                            class="focus:ring-indigo-500 h-4 w-4 text-indigo-600 border-gray-300 rounded"
                                            (change)="toggleHighlightText()" [checked]='highlightText'>
                                    </div>
                                    <div class="ml-3 text-sm">
                                        <label class="font-medium text-gray-700">Highlight text</label>
                                        <p id="comments-description" class="text-gray-500">During search, you can remove
                                            the text highlighting. This makes the search a bit faster.</p>
                                    </div>
                                </div>
                                <div class="relative flex items-start">
                                    <div class="flex items-center h-5">
                                        <input id="comments" type="checkbox"
                                            class="focus:ring-indigo-500 h-4 w-4 text-indigo-600 border-gray-300 rounded"
                                            (change)="toggleWeakSupervisionRelated()"
                                            [checked]='weakSupervisionRelated'>
                                    </div>
                                    <div class="ml-3 text-sm">
                                        <label class="font-medium text-gray-700">Only show weakly
                                            supervised-related</label>
                                        <p id="comments-description" class="text-gray-500">If checked, the data-browser
                                            will only show you heuristics that affect the weak supervision.</p>
                                    </div>
                                </div>
                            </fieldset>

                            <div class="modal-action">
                                <label for="config-modal"
                                    class="bg-white text-gray-700 text-xs font-semibold mr-3 px-4 py-2 rounded border border-gray-300 cursor-pointer hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 inline-block">Close</label>
                            </div>
                        </div>
                    </div>
                </div>

                <div data-tip="Download the currently filtered records"
                    class="tooltip tooltip-left relative flex items-center"
                    [ngClass]="extendedRecords?.sessionId ? '' : 'cursor-not-allowed'">
                    <button (click)="requestFileExport(project.id)" [disabled]="extendedRecords?.sessionId ? null:true"
                        [ngClass]="[extendedRecords?.sessionId ?  'opacity-100 cursor-pointer':'opacity-50 cursor-not-allowed pointer-events-none', downloadMessage == DownloadStateType.PREPARATION || downloadMessage == DownloadStateType.DOWNLOAD ? 'py-1' : 'py-2']"
                        class="mr-1 inline-flex items-center px-2.5 border border-gray-200 shadow-sm text-xs font-medium rounded text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 cursor-pointer">
                        <svg xmlns="http://www.w3.org/2000/svg" class="mr-1 h-5 w-5" fill="none" viewBox="0 0 24 24"
                            stroke="currentColor" stroke-width="2">
                            <path stroke-linecap="round" stroke-linejoin="round"
                                d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4" />
                        </svg>
                        Download filtered records
                        <span
                            *ngIf="downloadMessage == DownloadStateType.PREPARATION || downloadMessage == DownloadStateType.DOWNLOAD"
                            class="ml-2 inline-flex items-center rounded text-xs font-medium bg-gray-100 text-gray-800">
                            <kern-loading color="gray"></kern-loading>
                        </span>
                    </button>
                </div>

            </div>
        </div>
        <div class="flex flex-row flex-wrap mt-4" *ngIf="!(activeSlice?.static)">
            <!--search list-->
            <ng-template ngFor let-searchParam [ngForOf]="activeSearchParams" let-i="index">
                <div *ngFor="let searchText of searchParam.splittedText;let j = index"
                    class="flex flex-row items-center gap-y-1" style="max-width:95%">
                    <div class="whitespace-pre-line break-all inline-flex rounded-full items-center py-0.5 px-2.5 text-sm font-medium border border-green-700 bg-green-100 text-green-700 grid grid-cols-2 items-center mr-2"
                        style="grid-template-columns: auto max-content;">
                        <div class="flex items-center">
                            <svg xmlns="http://www.w3.org/2000/svg"
                                class="icon icon-tabler icon-tabler-filter inline-block" width="24" height="24"
                                viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none"
                                stroke-linecap="round" stroke-linejoin="round">
                                <path stroke="none" d="M0 0h24v24H0z" fill="none"></path>
                                <path d="M5.5 5h13a1 1 0 0 1 .5 1.5l-5 5.5l0 7l-4 -3l0 -4l-5 -5.5a1 1 0 0 1 .5 -1.5">
                                </path>
                            </svg>
                            <div class="whitespace-pre-line break-all m-auto">{{searchText}}</div>
                        </div>
                    </div>
                    <div *ngIf="!(i==activeSearchParams.length-1 && j==searchParam.splittedText.length-1)"
                        data-tip="intersection (AND)" class="tooltip mr-2">
                        <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-chart-circles"
                            width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor"
                            fill="none" stroke-linecap="round" stroke-linejoin="round">
                            <path stroke="none" d="M0 0h24v24H0z" fill="none"></path>
                            <circle cx="9.5" cy="9.5" r="5.5"></circle>
                            <circle cx="12" cy="12" r="2" fill="black"></circle>
                            <circle cx="14.5" cy="14.5" r="5.5"></circle>
                        </svg>
                    </div>
                </div>
            </ng-template>
        </div>

        <!--Search Result-->

        <div class="mb-3 mt-4 grow overflow-hidden overflow-y-auto" infiniteScroll [infiniteScrollDistance]="2"
            [infiniteScrollThrottle]="50" [scrollWindow]="false" (scrolled)="fetchMoreExtended()">

            <div *ngIf="loading" class="flex justify-center">
                <kern-loading size="btn-md"></kern-loading>
            </div>

            <div *ngIf="extendedRecords && attributes && !loading" class="mr-2">
                <div *ngIf="extendedRecords.fullCount == 0">Your search criteria didn't match any record.</div>
                <div *ngFor="let record of extendedRecords.recordList;let i = index"
                    class="bg-white overflow-hidden shadow rounded-lg border mb-4 pb-4">
                    <div class="px-4 py-5 sm:p-6">
                        <div *ngFor="let attribute of attributesSortOrder">
                            <div class="font-semibold text-sm text-gray-800 font-dmMono">
                                {{attributes.get(attribute.key).name}}
                            </div>
                            <div class="text-gray-800 text-sm mb-4 overflow-anywhere">
                                <ng-template [ngIf]=" highlightText && isTextHighlightNeeded &&
                                    isTextHighlightNeeded.get(attribute.key) &&
                                    record.data[attributes.get(attribute.key).name]" [ngIfElse]="noHighlight">
                                    <ngx-highlight-words
                                        [textToHighlight]="record.data[attributes.get(attribute.key).name].toString()"
                                        [searchWords]="textHighlightArray.get(attribute.key)" [autoEscape]="false"
                                        highlightClassName="bg-yellow-300">
                                    </ngx-highlight-words>
                                </ng-template>
                                <ng-template #noHighlight>
                                    {{record.data[attributes.get(attribute.key).name]}}
                                </ng-template>
                            </div>
                        </div>
                        <!--rla aggregation-->
                        <ng-template [ngIf]="record.rla_aggregation">
                            <div class="mt-2 flex flex-col">
                                <div *ngIf="weakSupervisionRelated && record.wsHint" class="text-gray-800 text-sm">
                                    {{record.wsHint}}</div>
                                <div class="overflow-x-auto">
                                    <div class="inline-block min-w-full align-middle">
                                        <div
                                            class="overflow-hidden shadow ring-1 ring-black ring-opacity-5 md:rounded-lg">
                                            <table class="min-w-full border divide-y divide-gray-300">
                                                <thead class="bg-gray-50">
                                                    <tr>
                                                        <th scope="col"
                                                            class="px-3 py-2 text-center text-xs font-medium uppercase tracking-wide text-gray-500">
                                                            Type</th>
                                                        <th scope="col"
                                                            class="px-3 py-2 text-center text-xs font-medium uppercase tracking-wide text-gray-500">
                                                            Task</th>
                                                        <th scope="col"
                                                            class="px-3 py-2 text-center text-xs font-medium uppercase tracking-wide text-gray-500">
                                                            Label</th>
                                                        <th scope="col"
                                                            class="px-3 py-2 text-center text-xs font-medium uppercase tracking-wide text-gray-500">
                                                            Amount</th>
                                                        <th scope="col"
                                                            class="px-3 py-2 text-center text-xs font-medium uppercase tracking-wide text-gray-500">
                                                            Avg. Confidence</th>
                                                    </tr>
                                                </thead>
                                                <tbody class="divide-y divide-gray-200 bg-white">
                                                    <tr *ngFor="let aggregation of record.rla_aggregation | keyvalue; let i = index"
                                                        [ngClass]="(i%2!=0 ? 'bg-gray-50':'bg-white') + (!weakSupervisionRelated || (weakSupervisionRelated && aggregation.value.isWSRelated)?'':' hidden')">
                                                        <td
                                                            class="whitespace-nowrap text-center px-3 py-2 text-sm text-gray-500">
                                                            {{aggregation.value.type}}</td>
                                                        <td
                                                            class="whitespace-nowrap text-center px-3 py-2 text-sm text-gray-500">
                                                            {{aggregation.value.task}}</td>
                                                        <td class="whitespace-nowrap text-center">
                                                            <span
                                                                class="inline-flex items-center px-2.5 py-0.5 rounded-md text-sm font-medium border border-0"
                                                                [ngClass]="[getBackground(aggregation.value.color), getText(aggregation.value.color), getBorder(aggregation.value.color)]">{{aggregation.value.label}}
                                                            </span>

                                                        </td>
                                                        <td
                                                            class="whitespace-nowrap text-center px-3 py-2 text-sm text-gray-500">
                                                            {{aggregation.value.amount}}</td>
                                                        <td
                                                            class="whitespace-nowrap text-center px-3 py-2 text-sm text-gray-500">
                                                            {{aggregation.value.confidenceAvg}}</td>
                                                    </tr>
                                                </tbody>
                                            </table>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </ng-template>
                        <div class="mt-3">
                            <div class="float-left">
                                <ng-template [ngIf]="similarSearchHelper.embeddings?.length==0">
                                    <div data-tip="Add an embedding in the project settings"
                                        class="tooltip tooltip-right relative z-50">
                                        <label class="text-gray-700 text-sm font-medium">
                                            <span class="cursor-help leading-5 underline"
                                                style="text-decoration-style: dotted;text-underline-offset: 2px;text-decoration-color: #22c55e">No
                                                embedding, can't find similar records</span>
                                        </label>
                                    </div>
                                </ng-template>
                                <ng-template [ngIf]="similarSearchHelper.embeddings?.length==1">
                                    <label (click)="requestSimilarSearch(record.id)"
                                        class="text-green-700 hover:text-green-500 text-sm font-medium cursor-pointer">
                                        <span class="leading-5">Find similar
                                            records
                                            <svg xmlns="http://www.w3.org/2000/svg"
                                                class="icon icon-tabler icon-tabler-angle inline-block" width="24"
                                                height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor"
                                                fill="none" stroke-linecap="round" stroke-linejoin="round">
                                                <path stroke="none" d="M0 0h24v24H0z" fill="none"></path>
                                                <path d="M21 19h-18l9 -15"></path>
                                                <path d="M20.615 15.171h.015"></path>
                                                <path d="M19.515 11.771h.015"></path>
                                                <path d="M17.715 8.671h.015"></path>
                                                <path d="M15.415 5.971h.015"></path>
                                            </svg>
                                        </span>
                                    </label>
                                </ng-template>
                                <ng-template [ngIf]="similarSearchHelper.embeddings?.length > 1">
                                    <label (click)="similarSearchHelper.rememberedRecordId = record.id"
                                        for="similarity-search-embedding-select"
                                        class="text-green-700 hover:text-green-500 text-sm font-medium cursor-pointer">
                                        <span class="leading-5">Find similar
                                            records
                                            <svg xmlns="http://www.w3.org/2000/svg"
                                                class="icon icon-tabler icon-tabler-angle inline-block" width="24"
                                                height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor"
                                                fill="none" stroke-linecap="round" stroke-linejoin="round">
                                                <path stroke="none" d="M0 0h24v24H0z" fill="none"></path>
                                                <path d="M21 19h-18l9 -15"></path>
                                                <path d="M20.615 15.171h.015"></path>
                                                <path d="M19.515 11.771h.015"></path>
                                                <path d="M17.715 8.671h.015"></path>
                                                <path d="M15.415 5.971h.015"></path>
                                            </svg>
                                        </span>
                                    </label>
                                </ng-template>
                            </div>
                        </div>

                        <div class="float-right">
                            <label class="text-green-700 hover:text-green-500 text-sm font-medium cursor-pointer"
                                (click)="storePreliminaryRecordIds(i+1)"
                                [routerLink]="['../labeling/' + extendedRecords.sessionId]"
                                [queryParams]="{pos: i+1,type:'SESSION'}">
                                <span class="leading-5">Continue with this record
                                    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 inline-block" fill="none"
                                        viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                                        <path stroke-linecap="round" stroke-linejoin="round"
                                            d="M13 7l5 5m0 0l-5 5m5-5H6" />
                                    </svg>
                                </span>
                            </label>
                        </div>

                    </div>
                </div>
            </div>
            <ng-template [ngIf]="similarSearchHelper.embeddings?.length>1">
                <input type="checkbox" id="similarity-search-embedding-select" class="modal-toggle">
                <div class="modal" *ngIf="similarSearchHelper.embeddings?.length>1">
                    <div class="modal-box text-black bg-white justify-center">
                        <div class="flex flex-grow justify-center text-lg leading-6 text-gray-900 font-medium">
                            Select embedding for similarity search </div>
                        <div *ngIf="activeSearchParams.length > 0 || similarSearchHelper.recordsInDisplay">
                            <div class="text-red-500 mb-2 flex flex-grow justify-center text-sm">
                                Warning: your current filter selection will be removed!</div>
                        </div>
                        <select #embeddingSelect class="select select-bordered select-sm w-full mt-4">
                            <option *ngFor="let embedding of similarSearchHelper.embeddings" [value]="embedding.id">
                                {{embedding.name }}
                            </option>
                        </select>
                        <div class="modal-action">
                            <label for="similarity-search-embedding-select"
                                class="mr-2 bg-green-100 text-green-700 border border-green-400 text-xs font-semibold px-4 py-2 rounded-md cursor-pointer hover:bg-green-200 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-green-500"
                                (click)="requestSimilarSearch(similarSearchHelper.rememberedRecordId,similarSearchHelper.embeddings[embeddingSelect.selectedIndex].id)">Search</label>
                            <label for="similarity-search-embedding-select"
                                class="bg-white text-gray-700 text-xs font-semibold mr-4 px-4 py-2 rounded border border-gray-300 cursor-pointer hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 inline-block">Close</label>
                        </div>
                    </div>
                </div>
            </ng-template>
            <input type="checkbox" id="user-info" class="modal-toggle">
            <div class="modal" *ngIf="userFilter.currentUserInfo">
                <div class="modal-box text-center">
                    <h1 class="text-lg text-gray-900 mb-2">Info</h1>
                    <div class="flex-grow items-center flex flex-col mb-2">
                        <div class="mb-4 ">{{userFilter.currentUserInfo.user.mail}}</div>
                        <div *ngIf="!userFilter.currentUserInfo.countSum">No labels associated with this user.</div>
                        <div class="grid gap-x-4 gap-y-2" style="grid-template-columns: max-content max-content;">
                            <div *ngFor="let pair of userFilter.currentUserInfo.counts" class="contents">
                                <div class="text-base text-gray-900 font-semibold">{{pair.source}}</div>
                                <div class="text-base text-gray-500 font-normal">{{pair.count + ' record' +
                                    (pair.count>1?'s':'')}}</div>
                            </div>
                            <div *ngIf="userFilter.currentUserInfo.counts >1" class="contents">
                                <div class="text-base text-gray-900 font-semibold mt-2">Sum</div>
                                <div class="text-base text-gray-500 font-normal mt-2">
                                    {{userFilter.currentUserInfo.countSum + ' record' +
                                    (userFilter.currentUserInfo.countSum>1?'s':'')}}</div>
                            </div>
                        </div>
                    </div>
                    <div class="modal-action">
                        <label for="user-info"
                            class="bg-white text-gray-700 text-xs font-semibold mr-4 px-4 py-2 rounded border border-gray-300 cursor-pointer hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 inline-block">Close</label>
                    </div>
                </div>
            </div>
            <input type="checkbox" id="slice-information" class="modal-toggle">
            <div class="modal">
                <div class="modal-box text-black bg-white justify-center"
                    style="max-width: 70%; width:fit-content; height:fit-content; max-height: 80%;min-width: 30%;">
                    <div class="flex flex-grow justify-center mb-4 font-bold">Slice information</div>
                    <div *ngFor="let item of sliceInfo | keyvalue : orderOriginal">
                        <ng-template [ngIf]="item.key == 'Link'" [ngIfElse]="normalDisplay">
                            <div class="mt-3 flex rounded-md">
                                <span
                                    class="inline-flex items-center rounded-l-md border border-r-0 border-gray-300 bg-gray-50 px-3 text-gray-500 sm:text-sm">{{item.value.startsWith("https")?
                                    'https://':'http://'}}</span>
                                <span data-tip="Copy to clipboard"
                                    (click)="copyToClipboard(item.value + '?pos=1&type=DATA_SLICE')" type="text"
                                    class="cursor-pointer tooltip border rounded-none rounded-r-md border-gray-300 px-3 py-2 focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm">
                                    {{item.value.substring(item.value.startsWith("https")?8:7)}}</span>

                            </div>
                            <div>
                                <button (click)="testLink(item.value + '?pos=1&type=DATA_SLICE')"
                                    class="mt-3 opacity-100 cursor-pointer w-40 bg-indigo-700 text-white text-xs leading-4 font-semibold px-4 py-2 rounded-md cursor-pointer hover:bg-indigo-800 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500">
                                    View as expert
                                </button>
                            </div>
                        </ng-template>
                        <ng-template #normalDisplay>
                            <div class="flex flex-grow justify-between gap-8">
                                <p>{{item.key}}</p>
                                <p>{{item.value}}</p>
                            </div>
                        </ng-template>
                    </div>
                    <div class="modal-action">
                        <label for="slice-information"
                            class="mr-2 bg-white text-gray-700 text-xs font-semibold mr-4 px-4 py-2 rounded border border-gray-300 cursor-pointer hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 inline-block">Close</label>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<ng-template #buttonLabelsDisabled>
    <button disabled
        class="cursor-not-allowed inline-flex rounded-md border border-gray-300 w-80 shadow-sm px-4 py-1.5 items-center bg-white text-xs font-semibold text-gray-700 cursor-pointer focus:ring-offset-2 focus:ring-offset-gray-400">
        <div class="truncate min-w-0 mr-4">
            No labels associated with this task
        </div>
        <svg class="-mr-1 ml-auto h-5 w-5" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor"
            aria-hidden="true">
            <path fill-rule="evenodd"
                d="M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z"
                clip-rule="evenodd" />
        </svg>
    </button>
</ng-template>