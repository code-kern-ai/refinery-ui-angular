<div *ngIf="project$ | async as project" class="flex flex-row h-full">
    <!--sidebar-->
    <div class="bg-white flex-auto h-full w-full overflow-hidden transition_all sidebar_width seperator_right"
        [ngClass]="isSearchMenuOpen?'sidebar_width_open ':null">
        <div class="flex flex-col select-none p-4 sidebar_width_open overflow-y-auto h-full"
            [ngClass]="isSearchMenuVisible? 'search_menu_width':null">
            <div class="flex flex-row items-center">
                <ng-template [ngIf]="isSearchMenuOpen">
                    <div class="bg-white text-lg font-medium text-gray-900" style="padding-right: 14px;">Existing data
                        slices</div>
                </ng-template>
                <div #menuOpener class="cursor-pointer" (click)="openSearchMenu(menuOpener)">
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-layout-sidebar"
                        width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none"
                        stroke-linecap="round" stroke-linejoin="round">
                        <path stroke="none" d="M0 0h24v24H0z" fill="none"></path>
                        <rect x="4" y="4" width="16" height="16" rx="2"></rect>
                        <line x1="9" y1="4" x2="9" y2="20"></line>
                    </svg>
                </div>
            </div>
            <div *ngIf="isSearchMenuOpen || isSearchMenuVisible" class="transition_all opacity-0"
                [ngClass]="isSearchMenuVisible&&isSearchMenuOpen?'opacity-100':null">
                <!-- Also, you can choose a preset below -->
                <div class="mt-2" [ngClass]="this.sliceNames.size > 6 ? null : 'hidden'">
                    <input type="text" placeholder="enter name to filter" [(ngModel)]="dataSliceFilter"
                        (ngModelChange)="filterAvailableSlices()" class="w-full input input-sm input-bordered p-2">

                </div>

                <div class="mt-2 mb-4" *ngIf="dataSlices">
                    <div *ngIf="dataSlices.length > 0"
                        class="w-full grid grid-cols-2 gap-y-1 items-center justify-center"
                        style="grid-column-gap: 26px;">
                        <div *ngFor="let dataSlice of dataSlices;let i=index" [attr.data-tip]="dataSlice.name"
                            [ngClass]="[sliceName.offsetWidth < sliceName.scrollWidth?'tooltip tooltip_slice_max_width':'',i%2==0?'tooltip-right':'tooltip-left']">

                            <button (click)="toggleSlice(dataSlice);"
                                class="cursor-pointer inline-flex items-center justify-between px-2.5 py-1.5 border border-gray-200 shadow-sm text-sm font-medium rounded text-gray-700 bg-white slice-width hover:bg-gray-50 focus:outline-none"
                                [ngClass]="getBorderStyle(dataSlice)"
                                [ngClass]="{'hidden':filteredSliceIds.has(dataSlice.id),'ring-2 ring-blue-500':activeSlice == dataSlice}">

                                <label class="cursor-pointer mr-2"
                                    (click)="updateSliceInfo(dataSlice.id);$event.stopPropagation(); dataBrowserModals.sliceInfo.open = true">
                                    <svg class="h-5 w-5 rounded-full stroke-0" xmlns="http://www.w3.org/2000/svg"
                                        viewBox="0 0 20 20" [ngStyle]="dataSlice.sliceType==SliceTypes.STATIC_OUTLIER?{background: 'rgb(77,124,15)', fill: 'rgb(236,252,203)'}:
                                    dataSlice.sliceType==SliceTypes.STATIC_DEFAULT?{background: 'rgb(180,83,9)', fill: 'rgb(254,243,199)'}:
                                    {background: 'rgb(29,78,216)', fill: 'rgb(219,234,254)'}" fill="currentColor"
                                        aria-hidden="true">
                                        <path fill-rule="evenodd"
                                            d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z"
                                            clip-rule="evenodd" />
                                    </svg>
                                </label>
                                <label #sliceName class="text-gray-700 truncate label-max-width cursor-pointer"
                                    [ngClass]="dataSlice.sliceType == SliceTypes.STATIC_OUTLIER?'text-xs whitespace-pre':'text-sm'">{{
                                    dataSlice.displayName }}</label>


                                <div
                                    (click)="dataBrowserModals.deleteSlice = {open: true, id: dataSlice.id}; $event.stopPropagation();">
                                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 ml-2 text-red-700"
                                        fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                                        <path stroke-linecap="round" stroke-linejoin="round"
                                            d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" />
                                    </svg>
                                </div>
                            </button>
                        </div>
                    </div>

                </div>

                <div class="relative">
                    <div class="absolute inset-0 flex items-center">
                        <div class="w-full border-t border-gray-300"
                            [ngClass]="activeSlice?.sliceType == SliceTypes.STATIC_OUTLIER || !(displayOutdatedWarning  || (activeSlice?.static && staticDataSliceCurrentCount!=null && activeSlice.count!=staticDataSliceCurrentCount)) ? '' : 'ml-20'">
                        </div>
                    </div>
                    <div class="relative flex justify-start">
                        <span class="pr-2 bg-white text-lg font-medium text-gray-900">Filter</span>
                        <div class="flex items-center tooltip-right text-gray-400"
                            data-tip="Outdated slice&#10;save to update"
                            [ngClass]="activeSlice?.sliceType == SliceTypes.STATIC_OUTLIER || !(displayOutdatedWarning  || (activeSlice?.static && staticDataSliceCurrentCount!=null && activeSlice.count!=staticDataSliceCurrentCount)) ? 'hidden':'tooltip'">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24"
                                stroke="currentColor" stroke-width="2">
                                <path stroke-linecap="round" stroke-linejoin="round"
                                    d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z" />
                            </svg>
                        </div>
                    </div>
                </div>
                <span class="text-sm text-gray-400">You can filter and order all your data in the browser
                    according
                    to your needs. Selected filter criteria can be saved and used later on.</span>

                <!--Dynamic Search Groups-->
                <ng-template [ngIf]="searchGroups">

                    <ng-template ngFor let-group [ngForOf]="searchGroupOrder">

                        <div class="mt-4">

                            <!-- Group header-->
                            <div #searchGroup [name]="group.key"
                                class="flex flex-row items-center transition_transform rounded-md hover:bg-gray-50 cursor-pointer"
                                (click)="toggleGroupMenu(group.key, searchGroup)">
                                <div class="w-7">
                                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none"
                                        viewBox="0 0 24 24" stroke="currentColor">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                            d="M19 9l-7 7-7-7" />
                                    </svg>
                                </div>
                                <div class="flex flex-col">
                                    <div class="font-bold truncate" style="max-width: 21rem;">
                                        {{searchGroups.get(group.key).name}}<label
                                            *ngIf="searchGroups.get(group.key).nameAdd !=''"
                                            class="font-normal ml-2">{{searchGroups.get(group.key).nameAdd}}</label>
                                    </div>
                                    <div class="text-xs text-gray-400 truncate" style="max-width: 21rem;">
                                        {{searchGroups.get(group.key).subText}}<label
                                            *ngIf="searchGroups.get(group.key).nameAdd !=''"
                                            class="font-normal ml-1">{{searchGroups.get(group.key).nameAdd}}</label>
                                    </div>
                                </div>
                            </div>
                            <!-- Group items -->
                            <div #searchGroupItems class="transition_all ml-4" [ngStyle]="{
                                    maxHeight: searchGroups.get(group.key).isOpen ? searchGroupItems.scrollHeight +'px' : '0px', 
                                    overflow: !searchGroups.get(group.key).isOpen  ? 'hidden' : 'visible'
                                  }">
                                <form [formGroup]="fullSearch.get(group.key)">
                                    <div formArrayName="groupElements">

                                        <ng-template ngFor let-groupItem
                                            [ngForOf]="getSearchFormArray(group.key).controls" let-i="index">
                                            <!--groupItem.get('id').value.toString()-->
                                            <div [formGroupName]="i" class="contents mx-2">

                                                <container-element [ngSwitch]="groupItem.get('group').value">
                                                    <ng-template ngSwitchDefault>
                                                        <p>
                                                            {{'Default :('}}
                                                        </p>
                                                    </ng-template>
                                                    <ng-template [ngSwitchCase]="SearchGroupType.ATTRIBUTES">
                                                        <div
                                                            class="flex flex-row items-center rounded-md hover:bg-gray-50 mt-2">
                                                            <div class="flex flex-col">
                                                                <div class="ml-2 mr-2 h-4 w-4 border-gray-300 border rounded cursor-pointer hover:bg-gray-200"
                                                                    (click)="setActiveNegateGroup(groupItem)"
                                                                    [ngStyle]="{'background-color':getActiveNegateGroupColor(groupItem), 'border-color':getActiveNegateGroupColor(groupItem)}">
                                                                </div>
                                                                <div *ngIf="getSearchFormArray(group.key).controls.length > 1"
                                                                    (click)="removeSearchGroupItem(groupItem.get('groupKey').value, groupItem.get('id').value)"
                                                                    class="cursor-pointer btn hover:border-transparent hover:bg-transparent border-transparent bg-transparent btn-xs px-0"
                                                                    style="margin-top:.2rem">
                                                                    <svg xmlns="http://www.w3.org/2000/svg"
                                                                        class="text-black inline-block w-4 h-4 stroke-current"
                                                                        fill="none" viewBox="0 0 24 24"
                                                                        stroke="currentColor">
                                                                        <path stroke-linecap="round"
                                                                            stroke-linejoin="round" stroke-width="2"
                                                                            d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" />
                                                                    </svg>
                                                                </div>
                                                            </div>
                                                            <div class="flex-grow mr-2.5 flex flex-col  mt-2 ">
                                                                <div class="flex-grow flex flex-row flex-wrap gap-1">
                                                                    <div style="width: 50%;" [ngStyle]="{
                                                                        'width': groupItem.get('operator').value == '' ? '100%' : '49%'
                                                                    }">
                                                                        <kern-dropdown [dropdownOptions]="{
                                                                            optionArray: attributesSortOrder,
                                                                            buttonCaption: groupItem.get('name').value,
                                                                            fontClass: 'font-dmMono',
                                                                            backgroundColors: colorsAttributes,
                                                                            hasFullWidth: true
                                                                        }"
                                                                            (optionClicked)="selectValueDropdown($event, i, 'name', group.key)">
                                                                        </kern-dropdown>
                                                                    </div>

                                                                    <div style="width: 49%;">
                                                                        <kern-dropdown
                                                                            *ngIf="groupItem.get('operator').value != ''"
                                                                            [dropdownOptions]="{
                                                                        optionArray: searchOperatorDropdownArray,
                                                                        buttonCaption: groupItem.get('operator').value,
                                                                        optionTooltips: tooltipsArray,
                                                                        fontClass: 'font-dmMono',
                                                                        hasFullWidth: true,
                                                                        buttonTooltipPosition: 'left',
                                                                        tooltipMaxWidthClass: 'tooltip_max_width_200'
                                                                    }" (optionClicked)="selectValueDropdown($event, i, 'operator', group.key)">
                                                                        </kern-dropdown>
                                                                    </div>
                                                                </div>

                                                                <ng-template
                                                                    [ngIf]="uniqueValuesDict[groupItem.get('name').value] && groupItem.get('operator').value != '' && groupItem.get('operator').value != 'BETWEEN'"
                                                                    [ngIfElse]="searchInputs">
                                                                    <div class="my-2">
                                                                        <kern-dropdown [dropdownOptions]="{
                                                                            optionArray: uniqueValuesDict[groupItem.get('name').value],
                                                                            buttonCaption: groupItem.get('searchValue').value,
                                                                            fontClass: 'font-dmMono',
                                                                            hasFullWidth: true
                                                                        }"
                                                                            (optionClicked)="selectValueDropdown($event, i, 'searchValue', group.key)"></kern-dropdown>
                                                                    </div>
                                                                </ng-template>

                                                                <ng-template #searchInputs>
                                                                    <div
                                                                        class="my-2 flex-grow flex flex-row items-center">
                                                                        <input
                                                                            *ngIf="groupItem.get('operator').value != ''"
                                                                            formControlName="searchValue"
                                                                            (keydown)="checkIfDecimals($event, i, group.key)"
                                                                            [placeholder]="groupItem.get('addText').value"
                                                                            class="w-full input input-sm input-bordered">

                                                                        <span class="text-sm text-gray-500 mx-1"
                                                                            *ngIf="groupItem.get('operator').value == 'BETWEEN'">AND</span>

                                                                        <input
                                                                            *ngIf="groupItem.get('operator').value == 'BETWEEN'"
                                                                            formControlName="searchValueBetween"
                                                                            (keydown)="checkIfDecimals($event, i, group.key)"
                                                                            [placeholder]="groupItem.get('addText').value"
                                                                            class="w-full input input-sm input-bordered">
                                                                    </div>
                                                                </ng-template>

                                                                <label
                                                                    class="text-xs text-gray-500 cursor-pointer flex items-center pb-2"
                                                                    *ngIf="(groupItem.get('operator').value == 'BEGINS WITH' || groupItem.get('operator').value == 'ENDS WITH' || groupItem.get('operator').value == 'CONTAINS' || groupItem.get('operator').value == 'IN WC') && (saveAttributeType!='INTEGER' && saveAttributeType !='FLOAT')">
                                                                    <input type="checkbox"
                                                                        formControlName="caseSensitive"
                                                                        class="mr-1 cursor-pointer">
                                                                    Case sensitive
                                                                </label>
                                                            </div>

                                                        </div>
                                                        <div class="w-full flex justify-center">
                                                            <ng-template
                                                                [ngIf]="i==getSearchFormArray(group.key).controls.length-1">
                                                                <label
                                                                    class="inline-flex items-center px-0.5 py-0.5 border border-gray-200 shadow-sm text-xs font-medium rounded text-gray-700 bg-white focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 cursor-pointer"
                                                                    (click)="addSearchGroupItem(groupItem, searchGroupItems)">
                                                                    <div>
                                                                        <svg xmlns="http://www.w3.org/2000/svg"
                                                                            class="h-5 w-5" fill="none"
                                                                            viewBox="0 0 24 24" stroke="currentColor">
                                                                            <path stroke-linecap="round"
                                                                                stroke-linejoin="round" stroke-width="2"
                                                                                d="M12 4v16m8-8H4" />
                                                                        </svg>
                                                                    </div>
                                                                </label>
                                                            </ng-template>
                                                        </div>
                                                    </ng-template>
                                                    <ng-template [ngSwitchCase]="SearchGroupType.USER_FILTER">
                                                        <div class="flex flex-row items-center mt-4">
                                                            <div class="flex-grow flex">
                                                                <div class="flex flex-col">
                                                                    <div *ngFor="let user of groupItem.get('users').controls; let k = index"
                                                                        class="my-1">
                                                                        <div
                                                                            class="form-control flex flex-row flex-nowrap">
                                                                            <label formArrayName="users"
                                                                                (click)="setActiveNegateGroup(user)"
                                                                                class="label p-0 search_reduced_item_width flex justify-start items-center">
                                                                                <div class="mr-2 h-4 w-4 border-gray-300 border rounded cursor-pointer hover:bg-gray-200"
                                                                                    [ngStyle]="{'background-color':getActiveNegateGroupColor(user), 'border-color':getActiveNegateGroupColor(user)}">
                                                                                </div>
                                                                                <span
                                                                                    class="label-text truncate">{{user.get("displayName").value}}
                                                                                </span>
                                                                            </label>
                                                                            <div
                                                                                *ngIf="userFilter.userMap.get(user.get('id').value) as userM">
                                                                                <div [attr.data-tip]="user.get('dataTip').value"
                                                                                    class="tooltip tooltip-left">
                                                                                    <label class="cursor-pointer"
                                                                                        (click)="dataBrowserModals.userInfo = {open: true, current: userM}">
                                                                                        <svg xmlns="http://www.w3.org/2000/svg"
                                                                                            class="h-4 w-4" fill="none"
                                                                                            viewBox="0 0 24 24"
                                                                                            stroke="currentColor"
                                                                                            stroke-width="2">
                                                                                            <path stroke-linecap="round"
                                                                                                stroke-linejoin="round"
                                                                                                d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
                                                                                        </svg>
                                                                                    </label>

                                                                                </div>
                                                                            </div>
                                                                        </div>
                                                                    </div>
                                                                </div>

                                                            </div>
                                                        </div>

                                                    </ng-template>
                                                    <ng-template [ngSwitchCase]="SearchGroupType.LABELING_TASKS">
                                                        <div class="flex flex-row items-center mt-4">
                                                            <div class="flex-grow flex flex-col ">

                                                                <div>Manually labeled</div>
                                                                <div class="flex-grow min-w-0">
                                                                    <div class="dropdown">
                                                                        <ng-template
                                                                            [ngIf]="groupItem.get('manualLabels').controls.length == 0"
                                                                            [ngIfElse]="dropDownML">
                                                                            <ng-container
                                                                                [ngTemplateOutlet]="buttonLabelsDisabled">
                                                                            </ng-container>
                                                                        </ng-template>
                                                                        <ng-template #dropDownML>
                                                                            <kern-dropdown [dropdownOptions]="{
                                                                                optionArray:groupItem.get('manualLabels').controls,
                                                                                hasCheckboxes:true,
                                                                                keepDropdownOpen:true
                                                                            }"
                                                                                (optionClicked)="setActiveNegateGroup($event)">
                                                                            </kern-dropdown>
                                                                        </ng-template>
                                                                    </div>
                                                                </div>
                                                                <div>
                                                                    <div class="mt-2">Weakly supervised</div>
                                                                    <div class="flex-grow min-w-0">
                                                                        <div class="dropdown">
                                                                            <ng-template
                                                                                [ngIf]="groupItem.get('weakSupervisionLabels').controls.length == 0"
                                                                                formArrayName="manualLabels"
                                                                                [ngIfElse]="dropDownWS">
                                                                                <ng-container
                                                                                    [ngTemplateOutlet]="buttonLabelsDisabled">
                                                                                </ng-container>
                                                                            </ng-template>
                                                                            <ng-template #dropDownWS>
                                                                                <kern-dropdown [dropdownOptions]="{
                                                                                optionArray:groupItem.get('weakSupervisionLabels').controls,
                                                                                hasCheckboxes:true,
                                                                                keepDropdownOpen:true
                                                                            }" (optionClicked)="setActiveNegateGroup($event)">
                                                                                </kern-dropdown>
                                                                            </ng-template>
                                                                        </div>
                                                                    </div>
                                                                    <div class="flex-grow min-w-0 mt-1">
                                                                        <div class="flex flex-row items-center"
                                                                            [formGroup]="groupItem.get('weakSupervisionConfidence')">
                                                                            <span
                                                                                class="label-text mr-0.5 font-dmMono">CONFIDENCE
                                                                                BETWEEN</span><input
                                                                                formControlName="lower" type="number"
                                                                                class="w-11 px-2 input input-sm input-bordered"
                                                                                (blur)="ensureValidConfidence(groupItem.get('weakSupervisionConfidence'))">
                                                                            <span
                                                                                class="label-text mx-0.5 font-dmMono">%
                                                                                AND</span>
                                                                            <input formControlName="upper" type="number"
                                                                                class="w-11 input input-sm input-bordered px-2"
                                                                                (blur)="ensureValidConfidence(groupItem.get('weakSupervisionConfidence'))">
                                                                            <span
                                                                                class="label-text mx-0.5 font-dmMono">%</span>
                                                                            <span
                                                                                *ngIf="groupItem.get('weakSupervisionConfidence').get('active').value"
                                                                                (click)="clearConfidence(groupItem.get('weakSupervisionConfidence'))"
                                                                                class="tooltip tooltip-bottom tooltip-max-width"
                                                                                data-tip="Clear filter for weakly supervised confidence">
                                                                                <svg xmlns="http://www.w3.org/2000/svg"
                                                                                    class="icon icon-tabler icon-tabler-filter-off text-red-700 cursor-pointer"
                                                                                    width="20" height="20"
                                                                                    viewBox="0 0 24 24" stroke-width="2"
                                                                                    stroke="currentColor" fill="none"
                                                                                    stroke-linecap="round"
                                                                                    stroke-linejoin="round">
                                                                                    <path stroke="none"
                                                                                        d="M0 0h24v24H0z" fill="none">
                                                                                    </path>
                                                                                    <line x1="3" y1="3" x2="21" y2="21">
                                                                                    </line>
                                                                                    <path
                                                                                        d="M9 5h9.5a1 1 0 0 1 .5 1.5l-4.049 4.454m-.951 3.046v5l-4 -3v-4l-5 -5.5a1 1 0 0 1 .18 -1.316">
                                                                                    </path>
                                                                                </svg>
                                                                            </span>
                                                                        </div>
                                                                    </div>
                                                                </div>
                                                                <div>
                                                                    <div class="mt-2">Model callback</div>
                                                                    <div class="flex-grow min-w-0">
                                                                        <div class="dropdown">
                                                                            <ng-template
                                                                                [ngIf]="groupItem.get('modelCallbackLabels').controls.length == 0"
                                                                                formArrayName="manualLabels"
                                                                                [ngIfElse]="dropDownMC">
                                                                                <ng-container
                                                                                    [ngTemplateOutlet]="buttonLabelsDisabled">
                                                                                </ng-container>
                                                                            </ng-template>
                                                                            <ng-template #dropDownMC>
                                                                                <kern-dropdown [dropdownOptions]="{
                                                                                optionArray:groupItem.get('modelCallbackLabels').controls,
                                                                                hasCheckboxes:true,
                                                                                keepDropdownOpen:true
                                                                            }" (optionClicked)="setActiveNegateGroup($event)">
                                                                                </kern-dropdown>
                                                                            </ng-template>
                                                                        </div>
                                                                    </div>
                                                                    <div class="flex-grow min-w-0 mt-1">
                                                                        <div class="flex flex-row items-center"
                                                                            [formGroup]="groupItem.get('modelCallbackConfidence')">
                                                                            <span
                                                                                class="label-text mr-0.5 font-dmMono">CONFIDENCE
                                                                                BETWEEN</span><input
                                                                                formControlName="lower" type="number"
                                                                                class="w-11 px-2 input input-sm input-bordered"
                                                                                (blur)="ensureValidConfidence(groupItem.get('modelCallbackConfidence'))">
                                                                            <span
                                                                                class="label-text mx-0.5 font-dmMono">%
                                                                                AND</span>
                                                                            <input formControlName="upper" type="number"
                                                                                class="w-11 input input-sm input-bordered px-2"
                                                                                (blur)="ensureValidConfidence(groupItem.get('modelCallbackConfidence'))">
                                                                            <span
                                                                                class="label-text mx-0.5 font-dmMono">%</span>
                                                                            <span
                                                                                *ngIf="groupItem.get('modelCallbackConfidence').get('active').value"
                                                                                (click)="clearConfidence(groupItem.get('modelCallbackConfidence'))"
                                                                                class="tooltip tooltip-bottom tooltip-max-width"
                                                                                data-tip="Clear filter for model callback confidence">
                                                                                <svg xmlns="http://www.w3.org/2000/svg"
                                                                                    class="icon icon-tabler icon-tabler-filter-off text-red-700 cursor-pointer"
                                                                                    width="20" height="20"
                                                                                    viewBox="0 0 24 24" stroke-width="2"
                                                                                    stroke="currentColor" fill="none"
                                                                                    stroke-linecap="round"
                                                                                    stroke-linejoin="round">
                                                                                    <path stroke="none"
                                                                                        d="M0 0h24v24H0z" fill="none">
                                                                                    </path>
                                                                                    <line x1="3" y1="3" x2="21" y2="21">
                                                                                    </line>
                                                                                    <path
                                                                                        d="M9 5h9.5a1 1 0 0 1 .5 1.5l-4.049 4.454m-.951 3.046v5l-4 -3v-4l-5 -5.5a1 1 0 0 1 .18 -1.316">
                                                                                    </path>
                                                                                </svg>
                                                                            </span>
                                                                        </div>
                                                                    </div>
                                                                </div>
                                                                <div class="mt-2 font-bold">Heuristics
                                                                </div>
                                                                <div>
                                                                    <ng-template
                                                                        [ngIf]="groupItem.get('informationSources').controls.length == 0"
                                                                        [ngIfElse]="functionBlock">
                                                                        <div class="text-sm text-gray-400">No
                                                                            Heuristics associated with this
                                                                            task</div>
                                                                    </ng-template>
                                                                    <ng-template #functionBlock>
                                                                        <div class="flex flex-col">
                                                                            <div
                                                                                class="seperator_bottom seperator_top py-2 mt-1">
                                                                                <div class="form-control">
                                                                                    <label
                                                                                        [formGroup]="groupItem.get('isWithDifferentResults')"
                                                                                        class="cursor-pointer label p-0 search_reduced_item_width"
                                                                                        (click)="setActiveNegateGroup(groupItem.get('isWithDifferentResults'))">
                                                                                        <div class="h-4 w-4 border-gray-300 border rounded hover:bg-gray-200"
                                                                                            [ngStyle]="{'background-color':getActiveNegateGroupColor(groupItem.get('isWithDifferentResults'))}">
                                                                                        </div>
                                                                                        <span
                                                                                            class="label-text truncate w-full pl-2">Only
                                                                                            with different
                                                                                            results</span>
                                                                                    </label>
                                                                                </div>

                                                                            </div>
                                                                            <div
                                                                                *ngFor="let lf of groupItem.get('informationSources').controls; let k = index">
                                                                                <div class="form-control mt-2">
                                                                                    <label
                                                                                        formArrayName="informationSources"
                                                                                        class="label p-0 search_reduced_item_width cursor-pointer"
                                                                                        (click)="setActiveNegateGroup(lf)">
                                                                                        <div class="h-4 w-4 border-gray-300 border rounded hover:bg-gray-200"
                                                                                            [ngStyle]="{'background-color':getActiveNegateGroupColor(lf), 'border-color':getActiveNegateGroupColor(lf)}">
                                                                                        </div>
                                                                                        <span
                                                                                            class="label-text truncate w-full pl-2">{{lf.get("name").value}}</span>
                                                                                    </label>
                                                                                </div>
                                                                            </div>
                                                                        </div>
                                                                    </ng-template>
                                                                </div>

                                                            </div>
                                                        </div>

                                                    </ng-template>
                                                    <ng-template [ngSwitchCase]="SearchGroupType.ORDER_STATEMENTS">
                                                        <div class="mt-4">
                                                            <div
                                                                *ngFor="let sortItem of groupItem.get('orderBy').controls; let k = index">
                                                                <div class="form-control class mb-2">
                                                                    <label
                                                                        *ngIf="sortItem.get('orderByKey').value != StaticOrderByKeysType.RANDOM"
                                                                        class="cursor-pointer label p-0 search_reduced_item_width"
                                                                        [ngClass]="sortItem.get('direction').value == 1?'rotate_transform':null"
                                                                        (click)="setSortForControl(sortItem)">
                                                                        <div
                                                                            class="h-4 w-4 border-gray-300 border rounded cursor-pointer hover:bg-gray-200">
                                                                            <ng-template
                                                                                [ngIf]="sortItem.get('active').value != 0">
                                                                                <svg xmlns="http://www.w3.org/2000/svg"
                                                                                    class="block" fill="none"
                                                                                    viewBox="0 0 24 24"
                                                                                    stroke="currentColor">
                                                                                    <path stroke-linecap="round"
                                                                                        stroke-linejoin="round"
                                                                                        stroke-width="2"
                                                                                        d="M17 13l-5 5m0 0l-5-5m5 5V6" />
                                                                                </svg>
                                                                            </ng-template>
                                                                        </div>
                                                                        <span
                                                                            class="ml-2 label-text truncate w-full">{{sortItem.get("displayName").value}}</span>
                                                                    </label>
                                                                    <div *ngIf="sortItem.get('orderByKey').value == StaticOrderByKeysType.RANDOM"
                                                                        [formGroup]="sortItem"
                                                                        class="flex flex-row items-center mr-2">
                                                                        <label class="label p-0 ">
                                                                            <div class="h-4 w-4 border-gray-300 border rounded cursor-pointer hover:bg-gray-200"
                                                                                (click)="setActiveNegateGroup(sortItem)"
                                                                                [ngStyle]="{'background-color':getActiveNegateGroupColor(sortItem), 'border-color':getActiveNegateGroupColor(sortItem)}">
                                                                            </div>
                                                                            <span
                                                                                class="label-text ml-1">{{sortItem.get("displayName").value}}</span>
                                                                        </label>
                                                                        <div class="flex rounded-md shadow-sm">
                                                                            <span
                                                                                class="ml-2 inline-flex items-center px-2.5 text-sm rounded-l-md border border-r-0 border-gray-300 bg-gray-50 text-gray-500 sm:text-sm">
                                                                                Seed
                                                                                <div (click)="generateRandomSeed(sortItem)"
                                                                                    class="ml-2 cursor-pointer">
                                                                                    <svg xmlns="http://www.w3.org/2000/svg"
                                                                                        class="icon icon-tabler icon-tabler-arrows-random"
                                                                                        width="18" height="18"
                                                                                        viewBox="0 0 24 24"
                                                                                        stroke-width="2"
                                                                                        stroke="currentColor"
                                                                                        fill="none"
                                                                                        stroke-linecap="round"
                                                                                        stroke-linejoin="round">
                                                                                        <path stroke="none"
                                                                                            d="M0 0h24v24H0z"
                                                                                            fill="none"></path>
                                                                                        <path d="M20 21.004h-4v-4">
                                                                                        </path>
                                                                                        <path d="M16 21.004l5 -5">
                                                                                        </path>
                                                                                        <path
                                                                                            d="M6.5 9.504l-3.5 -2l2 -3.504">
                                                                                        </path>
                                                                                        <path d="M3 7.504l6.83 -1.87">
                                                                                        </path>
                                                                                        <path d="M4 16.004l4 -1l1 4">
                                                                                        </path>
                                                                                        <path d="M8 15.004l-3.5 6">
                                                                                        </path>
                                                                                        <path
                                                                                            d="M21 5.004l-.5 4l-4 -.5">
                                                                                        </path>
                                                                                        <path d="M20.5 9.004l-4.5 -5.5">
                                                                                        </path>
                                                                                    </svg>
                                                                                </div>
                                                                            </span>
                                                                            <input formControlName="seedString"
                                                                                (focus)="$event.target.select()"
                                                                                class="w-36 input input-sm flex-1 min-w-0 block px-3 py-2 rounded-none rounded-r-md border border-0 border-gray-300 text-gray-500 sm:text-sm">
                                                                        </div>
                                                                    </div>
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </ng-template>
                                                    <ng-template [ngSwitchCase]="SearchGroupType.COMMENTS">
                                                        <div class="flex flex-row items-center mt-4">
                                                            <div class="flex-grow flex">
                                                                <div class="flex flex-col">
                                                                    <div *ngFor="let cObj of groupItem.get('hasComments').controls; let k = index"
                                                                        class="my-1">
                                                                        <div
                                                                            class="form-control flex flex-row flex-nowrap">
                                                                            <label formArrayName="hasComments"
                                                                                (click)="setActiveNegateGroup(cObj)"
                                                                                class="label p-0 search_reduced_item_width flex justify-start items-center">
                                                                                <div class="mr-2 h-4 w-4 border-gray-300 border rounded cursor-pointer hover:bg-gray-200"
                                                                                    [ngStyle]="{'background-color':getActiveNegateGroupColor(cObj), 'border-color':getActiveNegateGroupColor(cObj)}">
                                                                                </div>
                                                                                <span
                                                                                    class="label-text truncate cursor-pointer">Records
                                                                                    with comments
                                                                                </span>
                                                                            </label>
                                                                        </div>
                                                                    </div>
                                                                </div>

                                                            </div>
                                                        </div>
                                                    </ng-template>
                                                </container-element>
                                            </div>
                                        </ng-template>
                                    </div>
                                </form>
                            </div>
                        </div>
                    </ng-template>
                </ng-template>

                <div class="mt-4 grid items-center"
                    style="grid-template-columns: max-content max-content max-content max-content max-content;">
                    <div *ngIf="fullSearch?.get('DRILL_DOWN')" class="contents">
                        <form [formGroup]="fullSearch.get('DRILL_DOWN')" class="contents flex items-center">
                            <div data-tip="Connection within atomic filters" class="tooltip tooltip-right relative">
                                <div class="cursor-help mr-2 underline"
                                    style="text-decoration-style: dotted;text-underline-offset: 2px;text-decoration-color: #22c55e">
                                    Connect by
                                </div>
                            </div>
                            <div class="flex items-center">
                                <input id="radio-drill-down-inactive" type="radio" formControlName="DRILL_DOWN"
                                    class="focus:ring-blue-500 h-4 w-4 text-blue-600 border-gray-200" [value]="false">
                                <label for="radio-drill-down-inactive"
                                    class="cursor-pointer label p-1 label-text pr-2 font-dmMono">
                                    OR
                                </label>
                            </div>
                            <div class="flex items-center mr-3">
                                <input id="radio-drill-down-active" type="radio" formControlName="DRILL_DOWN" checked
                                    class="focus:ring-blue-500 h-4 w-4 text-blue-600 border-gray-200" [value]="true">
                                <label for="radio-drill-down-active"
                                    class="cursor-pointer label p-1 label-text pr-2 font-dmMono">
                                    AND
                                </label>
                            </div>
                        </form>
                    </div>
                </div>

                <div class="flex items-center mt-4">
                    <div data-tip="Store filters to disk" class="tooltip tooltip-top relative"
                        [ngClass]="similarSearchHelper.recordsInDisplay || activeSlide ? 'cursor-not-allowed':'' ">
                        <label
                            (click)="dataBrowserModals.filter.open = true; focusModalInputBox($event,'dataSliceName')"
                            class="mr-1 inline-flex items-center w-36 px-2.5 py-1.5 border border-gray-200 shadow-sm text-xs font-medium rounded text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 cursor-pointer"
                            [ngClass]="similarSearchHelper.recordsInDisplay || activeSlide ? 'opacity-50 cursor-not-allowed pointer-events-none' : 'opacity-100 cursor-pointer'"
                            [ngStyle]="similarSearchHelper.recordsInDisplay || activeSlide ? {'background-color': '#f9fafb','cursor': 'not-allowed'} : null">
                            <svg xmlns="http://www.w3.org/2000/svg" class="mr-2 icon icon-tabler icon-tabler-filter"
                                width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor"
                                fill="none" stroke-linecap="round" stroke-linejoin="round">
                                <path stroke="none" d="M0 0h24v24H0z" fill="none"></path>
                                <path d="M5.5 5h13a1 1 0 0 1 .5 1.5l-5 5.5l0 7l-4 -3l0 -4l-5 -5.5a1 1 0 0 1 .5 -1.5">
                                </path>
                            </svg>
                            Save data slice
                        </label>
                    </div>
                    <div>
                        <div data-tip="Update your current data slice" class="tooltip tooltip-top relative">
                            <button #updateButton
                                class="mr-1 inline-flex items-center w-38 px-2.5 py-1.5 border border-gray-200 shadow-sm text-xs font-medium rounded text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 cursor-pointer"
                                (click)="updateSlice()"
                                [disabled]="!activeSlice || activeSlice?.sliceType == SliceTypes.STATIC_OUTLIER || (activeSlice?.static && activeSlice.count==staticDataSliceCurrentCount && !displayOutdatedWarning)"
                                [ngClass]="!activeSlice || activeSlice?.sliceType == SliceTypes.STATIC_OUTLIER || (activeSlice?.static && activeSlice.count==staticDataSliceCurrentCount && !displayOutdatedWarning) ? 'opacity-50 cursor-not-allowed pointer-events-none' : 'opacity-100 cursor-pointer'">
                                <svg xmlns="http://www.w3.org/2000/svg"
                                    class="mr-2 icon icon-tabler icon-tabler-rotate-2" width="24" height="24"
                                    viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none"
                                    stroke-linecap="round" stroke-linejoin="round">
                                    <path stroke="none" d="M0 0h24v24H0z" fill="none"></path>
                                    <path d="M15 4.55a8 8 0 0 0 -6 14.9m0 -4.45v5h-5"></path>
                                    <line x1="18.37" y1="7.16" x2="18.37" y2="7.17"></line>
                                    <line x1="13" y1="19.94" x2="13" y2="19.95"></line>
                                    <line x1="16.84" y1="18.37" x2="16.84" y2="18.38"></line>
                                    <line x1="19.37" y1="15.1" x2="19.37" y2="15.11"></line>
                                    <line x1="19.94" y1="11" x2="19.94" y2="11.01"></line>
                                </svg>
                                Update data slice
                            </button>
                        </div>
                    </div>
                </div>
                <div class="mt-1">
                    <div [attr.data-tip]="!(similarSearchHelper.embeddings?.length && anyRecordManuallyLabeled) ? 'Create embedding to find outliers' : 'Creates a static data slice'"
                        class="tooltip tooltip-right tooltip_slice_max_width relative"
                        [ngClass]="!(similarSearchHelper.embeddings?.length && anyRecordManuallyLabeled) ? 'cursor-not-allowed' : ''">
                        <label
                            (click)="similarSearchHelper.embeddings?.length==1? requestOutlierSlice(): similarSearchHelper.embeddings?.length>1?dataBrowserModals.findOutliers.open=true: null"
                            [ngClass]="!(similarSearchHelper.embeddings?.length && anyRecordManuallyLabeled) ? 'opacity-50 cursor-not-allowed pointer-events-none' : 'opacity-100 cursor-pointer' "
                            class="text-green-800 text-sm font-medium">
                            <span
                                class="mr-1 inline-flex items-center w-36 px-2.5 py-1.5 border border-gray-200 shadow-sm text-xs font-medium rounded text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500">
                                <svg xmlns="http://www.w3.org/2000/svg"
                                    style="stroke: rgba(77,124,15); fill: rgba(236,252,203);"
                                    class="mr-2 icon icon-tabler icon-tabler-chart-bubble" width="24" height="24"
                                    viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none"
                                    stroke-linecap="round" stroke-linejoin="round">
                                    <path stroke="none" d="M0 0h24v24H0z" fill="none"></path>
                                    <circle cx="6" cy="16" r="3"></circle>
                                    <circle cx="16" cy="19" r="2"></circle>
                                    <circle cx="14.5" cy="7.5" r="4.5"></circle>
                                </svg>
                                Find outliers
                            </span>
                        </label>
                    </div>
                </div>
            </div>
        </div>

    </div>
    <!-- Main Page-->
    <div class="pt-4 bg-gray-100 flex-auto flex flex-col px-2 h-full transition_all"
        [ngClass]="isSearchMenuOpen || isSearchMenuVisible?'main_page_width_open':'main_page_width'">

        <!--Search header-->
        <div class="flex items-center justify-between">
            <ng-template [ngIf]="extendedRecords">
                <div>
                    <ng-template [ngIf]="extendedRecords.sql">
                        <label
                            (click)="dataBrowserModals.displaySql = {open: true, extendedRecordsSql: extendedRecords.sql}"
                            class="modal-button cursor-pointer">
                            <ng-container [ngTemplateOutlet]="countDisplay">
                            </ng-container>
                        </label>
                    </ng-template>
                    <ng-template [ngIf]="!extendedRecords.sql">
                        <ng-container [ngTemplateOutlet]="countDisplay">
                        </ng-container>
                    </ng-template>
                </div>

            </ng-template>
            <ng-template #countDisplay>
                <div class="text-sm select-none flex flex-row flex-nowrap whitespace-nowrap mr-2">
                    {{extendedRecords.fullCount
                    | number}}
                    Record{{extendedRecords.fullCount ===
                    1
                    ? '' : 's'}}
                    <div *ngIf="activeSlice?.static && activeSlice.count!=staticDataSliceCurrentCount"
                        class="tooltip tooltip-bottom"
                        [attr.data-tip]="'The count displayed is provided by the slice.&#10;The backend holds '+staticDataSliceCurrentCount +' Records with the same filter critera'"
                        style="white-space: break-spaces;">
                        <div>*</div>
                    </div>
                </div>
            </ng-template>
            <div class="flex flex-row items-center">
                <ng-template [ngIf]="activeSlice?.static || similarSearchHelper.recordsInDisplay">
                    <div class="rounded-md border border-yellow-500 mr-2 select-none">
                        <ng-template #staticWarning [ngIf]="activeSlice?.static" [ngIfElse]="similarWarning">
                            <div class="rounded-md bg-yellow-50 p-2">
                                <div class="flex items-center">
                                    <div class="flex-shrink-0">
                                        <svg class="h-5 w-5 text-yellow-400" xmlns="http://www.w3.org/2000/svg"
                                            viewBox="0 0 20 20" fill="currentColor" aria-hidden="true">
                                            <path fill-rule="evenodd"
                                                d="M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z"
                                                clip-rule="evenodd" />
                                        </svg>
                                    </div>
                                    <div class="ml-3">
                                        <p class="text-sm font-medium text-yellow-800">Static data slice active. Filter
                                            changes won't take effect{{activeSlice?.sliceType !=
                                            SliceTypes.STATIC_OUTLIER ? ' until you update the slice':''}}.</p>
                                        <div *ngIf="staticSliceOrderActive && activeSlice?.sliceType != SliceTypes.STATIC_OUTLIER"
                                            class="text-xs font-medium text-yellow-800">
                                            * Result order still takes effect: {{staticSliceOrderActive}}</div>
                                    </div>
                                </div>
                            </div>
                        </ng-template>
                        <ng-template #similarWarning>
                            <div class="rounded-md bg-yellow-50 p-2">
                                <div class="flex">
                                    <div class="flex-shrink-0">
                                        <svg class="h-5 w-5 text-yellow-400" xmlns="http://www.w3.org/2000/svg"
                                            viewBox="0 0 20 20" fill="currentColor" aria-hidden="true">
                                            <path fill-rule="evenodd"
                                                d="M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z"
                                                clip-rule="evenodd" />
                                        </svg>
                                    </div>
                                    <div class="ml-3">
                                        <p class="text-sm font-medium text-yellow-800">Similarity search active. Filter
                                            changes will replace search results.</p>
                                    </div>
                                </div>
                            </div>
                        </ng-template>
                    </div>
                </ng-template>
                <button *ngIf="activeSlice || activeSearchParams.length > 0 || similarSearchHelper.recordsInDisplay"
                    class="mr-1 inline-flex items-center px-2.5 py-2 border border-gray-300 shadow-sm text-xs font-semibold rounded-md text-gray-700 bg-white hover:bg-gray-50 focus:outline-none cursor-pointer"
                    (click)="clearFilters()">
                    <svg xmlns="http://www.w3.org/2000/svg" class="mr-2 icon icon-tabler icon-tabler-filter-off"
                        width="16" height="16" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none"
                        stroke-linecap="round" stroke-linejoin="round">
                        <path stroke="none" d="M0 0h24v24H0z" fill="none"></path>
                        <line x1="3" y1="3" x2="21" y2="21"></line>
                        <path
                            d="M9 5h9.5a1 1 0 0 1 .5 1.5l-4.049 4.454m-.951 3.046v5l-4 -3v-4l-5 -5.5a1 1 0 0 1 .18 -1.316">
                        </path>
                    </svg>
                    Clear filter
                </button>

                <div class="tooltip tooltip-left" data-tip="Change the data browser configurations">
                    <button
                        class="mr-1 inline-flex items-center px-2.5 py-2 border border-gray-300 shadow-sm text-xs font-semibold rounded-md text-gray-700 bg-white hover:bg-gray-50 focus:outline-none cursor-pointer"
                        (click)="dataBrowserModals.configuration.open = true; focusModalInputBox($event,'config')">
                        <svg xmlns="http://www.w3.org/2000/svg"
                            class="mr-2 icon icon-tabler icon-tabler-adjustments inline-block" width="16" height="16"
                            viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none"
                            stroke-linecap="round" stroke-linejoin="round">
                            <path stroke="none" d="M0 0h24v24H0z" fill="none"></path>
                            <circle cx="6" cy="10" r="2"></circle>
                            <line x1="6" y1="4" x2="6" y2="8"></line>
                            <line x1="6" y1="12" x2="6" y2="20"></line>
                            <circle cx="12" cy="16" r="2"></circle>
                            <line x1="12" y1="4" x2="12" y2="14"></line>
                            <line x1="12" y1="18" x2="12" y2="20"></line>
                            <circle cx="18" cy="7" r="2"></circle>
                            <line x1="18" y1="4" x2="18" y2="5"></line>
                            <line x1="18" y1="9" x2="18" y2="20"></line>
                        </svg>
                        Configuration
                    </button>
                </div>
                <kern-export [sessionId]="extendedRecords?.sessionId" class="mr-3"></kern-export>
            </div>
        </div>
        <div class="flex flex-row flex-wrap mt-4" *ngIf="!(activeSlice?.static)">
            <!--search list-->
            <ng-template ngFor let-searchParam [ngForOf]="activeSearchParams" let-i="index">
                <div *ngFor="let searchText of searchParam.splittedText;let j = index"
                    class="flex flex-row items-center gap-y-1" style="max-width:95%">
                    <div class="whitespace-pre-line break-all inline-flex rounded-full items-center py-0.5 px-2.5 text-sm font-medium border border-green-700 bg-green-100 text-green-700 grid grid-cols-2 items-center mr-2"
                        style="grid-template-columns: auto max-content;">
                        <div class="flex items-center">
                            <svg xmlns="http://www.w3.org/2000/svg"
                                class="icon icon-tabler icon-tabler-filter inline-block" width="24" height="24"
                                viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none"
                                stroke-linecap="round" stroke-linejoin="round">
                                <path stroke="none" d="M0 0h24v24H0z" fill="none"></path>
                                <path d="M5.5 5h13a1 1 0 0 1 .5 1.5l-5 5.5l0 7l-4 -3l0 -4l-5 -5.5a1 1 0 0 1 .5 -1.5">
                                </path>
                            </svg>
                            <div class="whitespace-pre-line break-all m-auto">{{searchText}}</div>
                        </div>
                    </div>
                    <div *ngIf="!(i==activeSearchParams.length-1 && j==searchParam.splittedText.length-1)"
                        data-tip="intersection (AND)" class="tooltip mr-2">
                        <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-chart-circles"
                            width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor"
                            fill="none" stroke-linecap="round" stroke-linejoin="round">
                            <path stroke="none" d="M0 0h24v24H0z" fill="none"></path>
                            <circle cx="9.5" cy="9.5" r="5.5"></circle>
                            <circle cx="12" cy="12" r="2" fill="black"></circle>
                            <circle cx="14.5" cy="14.5" r="5.5"></circle>
                        </svg>
                    </div>
                </div>
            </ng-template>
        </div>

        <!--Search Result-->

        <div class="mb-3 mt-4 grow overflow-hidden overflow-y-auto" infiniteScroll [infiniteScrollDistance]="2"
            [infiniteScrollThrottle]="50" [scrollWindow]="false" (scrolled)="fetchMoreExtended()">

            <div *ngIf="loading" class="flex justify-center">
                <kern-loading size="btn-md"></kern-loading>
            </div>

            <div *ngIf="extendedRecords && attributes && !loading" class="mr-2">
                <div *ngIf="extendedRecords.fullCount == 0">Your search criteria didn't match any record.</div>
                <kern-record-list [attributes]="attributes" [recordList]="extendedRecords.recordList"
                    [recordListOptions]="{
                    recordComments: recordComments,
                    dataBrowserModals: dataBrowserModals,
                    attributesSortOrder: attributesSortOrder,
                    textHighlightArrayKern: textHighlightArrayKern,
                    isTextHighlightNeeded: isTextHighlightNeeded,
                    similarSearchHelper: similarSearchHelper
                }" (similaritySearchRequested)="requestSimilarSearch()"
                    (recordClicked)="storePreliminaryRecordIds($event)">
                </kern-record-list>
            </div>
        </div>
    </div>
</div>

<ng-template #buttonLabelsDisabled>
    <button disabled
        class="cursor-not-allowed inline-flex rounded-md border border-gray-300 w-80 shadow-sm px-4 py-1.5 items-center bg-white text-xs font-semibold text-gray-700 cursor-pointer focus:ring-offset-2 focus:ring-offset-gray-400">
        <div class="truncate min-w-0 mr-4">
            No labels associated with this task
        </div>
        <svg class="-mr-1 ml-auto h-5 w-5" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor"
            aria-hidden="true">
            <path fill-rule="evenodd"
                d="M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z"
                clip-rule="evenodd" />
        </svg>
    </button>
</ng-template>



<kern-modal [isOpen]="dataBrowserModals.userInfo.open" closeButton="X"
    (optionClicked)="dataBrowserModals.userInfo.open = false">
    <h1 class="text-lg text-gray-900 mb-2 text-center">Info</h1>
    <div class="flex-grow items-center flex flex-col mb-2" *ngIf="dataBrowserModals.userInfo.current">
        <div class="mb-4 ">{{dataBrowserModals.userInfo.current.user.mail}}</div>
        <div *ngIf="!dataBrowserModals.userInfo.current.countSum">No labels associated with this user.</div>
        <div class="grid gap-x-4 gap-y-2" style="grid-template-columns: max-content max-content;">
            <div *ngFor="let pair of dataBrowserModals.userInfo.current.counts" class="contents">
                <div class="text-base text-gray-900 font-semibold">{{pair.source}}</div>
                <div class="text-base text-gray-500 font-normal">{{pair.count + ' record' +
                    (pair.count>1?'s':'')}}</div>
            </div>
            <div *ngIf="dataBrowserModals.userInfo.current.counts >1" class="contents">
                <div class="text-base text-gray-900 font-semibold mt-2">Sum</div>
                <div class="text-base text-gray-500 font-normal mt-2">
                    {{dataBrowserModals.userInfo.current.countSum + ' record' +
                    (dataBrowserModals.userInfo.current.countSum>1?'s':'')}}</div>
            </div>
        </div>
    </div>
</kern-modal>

<kern-modal [isOpen]="dataBrowserModals.filter.open" closeButton="X" [modalBoxStyle]="{'width':'35rem'}" [acceptButton]="{
    buttonCaption: dataBrowserModals.filter.sliceNameExists? 'Update data slice':'Save data slice',
    disabled: inputSliceName.value == '',
    emitObject: this,
    emitFunction: dataBrowserModals.filter.sliceNameExists? updateSliceByName :createSlice
}" (optionClicked)="dataBrowserModals.filter.open = false;">
    <div class="flex flex-grow justify-center text-lg leading-6 text-gray-900 font-medium">
        Data slice creation</div>
    <div class="mb-2 flex flex-grow justify-center text-sm">
        Save or update the current filter settings as a data slice</div>
    <p class="pt-4">You have two choices.
        <label class="block font-bold mt-2">Dynamic:</label>
        Stores the current filter critera and is reapplied whenever the data slice is
        selected.<br><br>
        <label class="block font-bold mt-2 ">Static:</label>
        Used for visualization filters and scope of
        work for annotators & domain experts.
        Stores the current records provided by your filter.
        These are limited to 10,000 records and can be refreshed if necessary.
    </p>
    <div class="mt-2">
        <div class="flex">
            <div class="inline-flex">
                <div class="form-control">
                    <label class="cursor-pointer label">
                        <span class="label-text mr-1">Dynamic</span>
                        <input #inputDynamic type="radio" style="--focus-shadow:none;accent-color:rgb(29,78,216)"
                            (click)="setStatic(inputDynamic,inputStatic,false)"
                            class="h-4 w-4 border-gray-200 cursor-pointer" checked [value]="true">
                    </label>
                </div>
                <div class="form-control">
                    <label class="cursor-pointer label">
                        <span class="label-text mr-1">Static</span>
                        <input #inputStatic type="radio" style="--focus-shadow:none;accent-color:rgb(180,83,9)"
                            (click)="setStatic(inputDynamic,inputStatic,true)"
                            class="h-4 w-4 border-gray-200 cursor-pointer" [value]="false">
                    </label>
                </div>
            </div>
            <div data-tip="Too many records for a static slice" class="relative tooltip mr-1"
                style="white-space: break-spaces;">
                <div class="flex justify-center items-center w-full h-full"
                    [ngClass]="{hidden:!dataBrowserModals.filter.displayStaticNotAllowedWarning}">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24"
                        stroke="currentColor" stroke-width="2">
                        <path fill="#E8CD20" stroke-linecap="round" stroke-linejoin="round"
                            d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z" />
                    </svg>
                </div>
            </div>
        </div>
        <div class="flex w-full justify-between mt-2">
            <input #inputSliceName type="text" class="w-full input input-bordered input-sm" placeholder="Enter name"
                name="dataSliceName" [value]="dataBrowserModals.filter.name"
                (input)="setSliceName(inputSliceName.value)" (keyup)="checkNameExists(inputSliceName.value)"
                (keydown.enter)="dataBrowserModals.filter.open = false; dataBrowserModals.filter.sliceNameExists ?
            updateSliceByName():createSlice()">
        </div>
    </div>

</kern-modal>

<kern-modal [isOpen]="dataBrowserModals.sliceInfo.open" closeButton="X"
    (optionClicked)="dataBrowserModals.sliceInfo.open = false">
    <div class="flex flex-grow justify-center mb-4 font-bold">Slice information</div>
    <div *ngFor="let item of dataBrowserModals.sliceInfo.data | defaultOrderKeyvalue">
        <ng-template [ngIf]="item.key == 'Link'" [ngIfElse]="normalDisplay">
            <div class="mt-3 flex rounded-md">
                <span
                    class="inline-flex items-center rounded-l-md border border-r-0 border-gray-300 bg-gray-50 px-3 text-gray-500 sm:text-sm">{{item.value.startsWith("https")?
                    'https://':'http://'}}</span>
                <span data-tip="Copy to clipboard" (click)="copyToClipboard(item.value + '?pos=1&type=DATA_SLICE')"
                    type="text"
                    class="cursor-pointer tooltip border rounded-none rounded-r-md border-gray-300 px-3 py-2 focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm">
                    {{item.value.substring(item.value.startsWith("https")?8:7)}}</span>

            </div>
            <div data-tip="Only usable for the managed version" [ngClass]="!isManaged ?'tooltip tooltip-right' : ''">
                <button (click)="testLink(item.value + '?pos=1&type=DATA_SLICE')" [disabled]="!isManaged"
                    [ngClass]="!isManaged?'opacity-50 cursor-not-allowed':'opacity-100 cursor-pointer'"
                    class="mt-3 opacity-100 cursor-pointer w-40 bg-indigo-700 text-white text-xs leading-4 font-semibold px-4 py-2 rounded-md cursor-pointer hover:bg-indigo-800 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500">
                    View as expert
                </button>
            </div>
        </ng-template>
        <ng-template #normalDisplay>
            <div class="flex flex-grow justify-between gap-8">
                <p>{{item.key}}</p>
                <p>{{item.value}}</p>
            </div>
        </ng-template>
    </div>
</kern-modal>

<kern-modal [isOpen]="dataBrowserModals.configuration.open" closeButton="X"
    (optionClicked)="dataBrowserModals.configuration.open = false">
    <div class="flex flex-grow justify-center text-lg leading-6 text-gray-900 font-medium">
        View configuration </div>
    <div class="mb-2 flex flex-grow justify-center text-sm">
        Change the content that is displayed in the browser.</div>
    <div class="mb-2">
        <fieldset class="space-y-5">
            <div class="relative flex items-start">
                <div class="flex items-center h-5">
                    <input id="comments" type="checkbox"
                        class="focus:ring-indigo-500 h-4 w-4 text-indigo-600 border-gray-300 rounded cursor-pointer"
                        (change)="toggleHighlightText()" [checked]="dataBrowserModals.configuration.highlightText">
                </div>
                <div class="ml-3 text-sm cursor-pointer" (click)="toggleHighlightText()">
                    <label class="font-medium text-gray-700 cursor-pointer">Highlight text</label>
                    <p id="comments-description" class="text-gray-500">During search, you can remove
                        the text highlighting. This makes the search a bit faster.</p>
                </div>
            </div>
            <div class="relative flex items-start">
                <div class="flex items-center h-5">
                    <input id="comments" type="checkbox"
                        class="focus:ring-indigo-500 h-4 w-4 text-indigo-600 border-gray-300 rounded cursor-pointer"
                        (change)="toggleWeakSupervisionRelated()"
                        [checked]="dataBrowserModals.configuration.weakSupervisionRelated">
                </div>
                <div class="ml-3 text-sm cursor-pointer" (click)="toggleWeakSupervisionRelated()">
                    <label class="font-medium text-gray-700 cursor-pointer">Only show weakly
                        supervised-related</label>
                    <p id="comments-description" class="text-gray-500">If checked, the data-browser
                        will only show you heuristics that affect the weak supervision.</p>
                </div>
            </div>
            <div class="relative flex items-start">
                <div class="flex items-center h-5">
                    <input type="checkbox"
                        class="focus:ring-indigo-500 h-4 w-4 text-indigo-600 border-gray-300 rounded cursor-pointer"
                        (change)="toggleLineBreaks()"
                        [checked]="dataBrowserModals.configuration.lineBreaks != LineBreaksType.NORMAL">
                </div>
                <div class="ml-3 text-sm cursor-pointer" (click)="toggleLineBreaks()">
                    <label class="font-medium text-gray-700 cursor-pointer">Visible line breaks</label>
                    <p class="text-gray-500">If checked, the attributes in the data-browser and labeling page
                        will be shown with line breaks</p>
                </div>
            </div>
            <div *ngIf="dataBrowserModals.configuration.lineBreaks != LineBreaksType.NORMAL" class="px-10">
                <div class="flex flex-row items-start mt-2">
                    <input type="radio"
                        [checked]="dataBrowserModals.configuration.lineBreaks == LineBreaksType.IS_PRE_WRAP"
                        (change)="toggleLineBreaksPreWrap(LineBreaksType.IS_PRE_LINE)" name="lineBreaks" id="preWrap"
                        class="focus:ring-blue-500 h-6 w-4 text-blue-600 border-gray-200 cursor-pointer">
                    <label for="preWrap" class="ml-1 block text-sm font-medium text-gray-700 cursor-pointer">
                        <span>Pre-wrap</span>
                        <p class="text-gray-500 text-sm cursor-pointer">Preserves whitespace and line breaks </p>
                    </label>
                </div>
                <div class="flex flex-row items-start mt-2">
                    <input type="radio"
                        [checked]="dataBrowserModals.configuration.lineBreaks == LineBreaksType.IS_PRE_LINE"
                        (change)="toggleLineBreaksPreWrap(LineBreaksType.IS_PRE_WRAP)" name="lineBreaks" id="preLine"
                        class="focus:ring-blue-500 h-6 w-4 text-blue-600 border-gray-200 cursor-pointer">
                    <label for="preLine" class="ml-1 block text-sm font-medium text-gray-700 cursor-pointer">
                        <span>Pre-line</span>
                        <p class="text-gray-500 text-sm cursor-pointer">Collapses multiple whitespaces and line breaks
                            into
                            a single space </p>
                    </label>
                </div>
            </div>
        </fieldset>

        <div class="mt-3 text-sm text-gray-900">Select which separator you want to use for the IN
            operator</div>

        <div class="flex flex-row items-center my-2">
            <input type="radio" [(ngModel)]="dataBrowserModals.configuration.separator" value="," name="separator"
                id="comma" class="focus:ring-blue-500 h-4 w-4 text-blue-600 border-gray-200 cursor-pointer">
            <label for="comma" class="ml-1 block text-sm font-medium text-gray-700 cursor-pointer">Comma
                (,)</label>
        </div>
        <div class="flex flex-row items-center my-2">
            <input type="radio" [(ngModel)]="dataBrowserModals.configuration.separator" value="-" name="separator"
                id="dash" class="focus:ring-blue-500 h-4 w-4 text-blue-600 border-gray-200 cursor-pointer">
            <label for="dash" class="ml-1 block text-sm font-medium text-gray-700 cursor-pointer">Dash (-)</label>
        </div>
    </div>
</kern-modal>

<ng-template [ngIf]="similarSearchHelper.embeddings?.length>1">
    <kern-modal [isOpen]="dataBrowserModals.findOutliers.open" closeButton="X" [acceptButton]="{
        buttonCaption: 'Build',
        emitObject: this, emitFunction: requestOutlierSlice}"
        (optionClicked)="dataBrowserModals.findOutliers.open = false">
        <div *ngIf="similarSearchHelper.embeddings?.length>1"
            class="flex flex-grow justify-center text-lg leading-6 text-gray-900 font-medium">
            Select embedding for outlier search </div>
        <div *ngIf="activeSearchParams.length > 0 || similarSearchHelper.recordsInDisplay">
            <div class="text-red-500 mb-2 flex flex-grow justify-center text-sm">
                Warning: your current filter selection will be removed!</div>
        </div>
        <select #embeddingSelect class="select select-bordered select-sm w-full mt-4"
            (change)="setEmbeddingId(embeddingSelect.selectedIndex)">
            <option *ngFor="let embedding of similarSearchHelper.embeddings" [value]="embedding.id">
                {{embedding.name }}
            </option>
        </select>
    </kern-modal>
</ng-template>

<kern-modal [isOpen]="dataBrowserModals.deleteSlice.open" closeButton="X" [modalBoxStyle]="{'width':'30rem'}"
    [abortButton]="{
    buttonCaption: 'Delete data slice',
    emitObject: this, emitFunction: deleteSlice
}" (optionClicked)="dataBrowserModals.deleteSlice.open = false">
    <h1 class="text-lg text-gray-900 mb-2 text-center">Warning</h1>
    <div class="text-sm text-gray-500 my-2 text-center">
        Are you sure you want to delete this data slice?
    </div>
</kern-modal>

<kern-modal [isOpen]="dataBrowserModals.displaySql.open" closeButton="X"
    (optionClicked)="dataBrowserModals.displaySql.open = false">
    <div class="flex flex-grow justify-center">
        <div data-tip="Copy to clipboard" class="tooltip">
            <div class="cursor-pointer" (click)="copyToClipboard(dataBrowserModals.displaySql.extendedRecordsSql)">
                Info
            </div>
        </div>
    </div>
    <pre class="mt-6 text-left"
        style="white-space: pre-wrap; overflow: auto; max-height: 700px; ">{{dataBrowserModals.displaySql.extendedRecordsSql}}</pre>
</kern-modal>

<kern-modal [isOpen]="dataBrowserModals.similaritySearch.open" [modalBoxStyle]="{'width':'30%'}" closeButton="X"
    [acceptButton]="{
    buttonCaption: 'Search',
    emitObject: this, emitFunction:requestSimilarSearch
}" (optionClicked)="dataBrowserModals.similaritySearch.open = false">
    <div class="flex flex-grow justify-center text-lg leading-6 text-gray-900 font-medium">
        Select embedding for similarity search </div>
    <div *ngIf="activeSearchParams.length > 0 || similarSearchHelper.recordsInDisplay">
        <div class="text-red-500 mb-2 flex flex-grow justify-center text-sm">
            Warning: your current filter selection will be removed!</div>
    </div>
    <select #embeddingSelectSS class="select select-bordered select-sm w-full mt-4"
        (change)="setEmbeddingIdSimilaritySearch(embeddingSelectSS.selectedIndex)">
        <option *ngFor="let embedding of similarSearchHelper.embeddings" [value]="embedding.id">
            {{embedding.name }}
        </option>
    </select>

    <ng-template [ngIf]="filterIntegration.filterAttributesSS && filterIntegration.filterAttributesSS.length > 0">
        <div class="flex flex-col justify-start mt-4">
            <div class="pr-2 bg-white text-md font-medium text-gray-900">Filter attributes</div>
            <div class="text-sm text-gray-400">You can filter similarity search based on the attributes selected when
                creating the embedding</div>
        </div>

        <form [formGroup]="filterIntegration.filterAttributesSSForm">
            <div formArrayName="filterAttributes">
                <ng-container
                    *ngFor="let groupItem of filterIntegration.getFilterAttributesSS().controls; let i = index">
                    <div [formGroupName]="i" class="contents mx-2">
                        <div class="flex flex-row items-center rounded-md hover:bg-gray-50 mt-2">
                            <div class="flex flex-col">
                                <div *ngIf="filterIntegration.getFilterAttributesSS().controls.length > 1"
                                    (click)="filterIntegration.removeFilterAttributesSS(i)"
                                    class="cursor-pointer btn hover:border-transparent hover:bg-transparent border-transparent bg-transparent btn-xs px-0"
                                    style="margin-top:.2rem">
                                    <svg xmlns="http://www.w3.org/2000/svg"
                                        class="text-black inline-block w-4 h-4 stroke-current" fill="none"
                                        viewBox="0 0 24 24" stroke="currentColor">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                            d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" />
                                    </svg>
                                </div>
                            </div>
                            <div class="flex-grow flex flex-col  mt-2 ">
                                <div class="flex-grow flex flex-row gap-2">
                                    <div style="width: 50%;">
                                        <kern-dropdown [dropdownOptions]="{
                                            optionArray: filterIntegration.filterAttributesSS,
                                            buttonCaption: groupItem.get('name').value,
                                            fontClass: 'font-dmMono',
                                            backgroundColors: filterIntegration.colorsAttributes,
                                            hasFullWidth: true
                                        }"
                                            (optionClicked)="filterIntegration.setFilterDropdownVal($event, i, 'name')"></kern-dropdown>
                                    </div>
                                    <div style="width: 49%;">
                                        <kern-dropdown [dropdownOptions]="{
                                            optionArray: filterIntegration.operatorDropdownArray,
                                            buttonCaption: groupItem.get('operator').value,
                                            fontClass: 'font-dmMono',
                                            hasFullWidth: true,
                                            optionTooltips: filterIntegration.tooltipsArray,
                                            buttonTooltipPosition: 'left',
                                            tooltipMaxWidthClass: 'tooltip_max_width_200'
                                        }"
                                            (optionClicked)="filterIntegration.setFilterDropdownVal($event, i, 'operator')"></kern-dropdown>
                                    </div>
                                </div>

                                <div class="my-2 flex-grow flex flex-row items-center">
                                    <ng-template
                                        [ngIf]="filterIntegration.uniqueValuesDict[groupItem.get('name').value] && groupItem.get('operator').value != '' && groupItem.get('operator').value != 'BETWEEN'"
                                        [ngIfElse]="searchInputs">
                                        <div class="my-2 w-full">
                                            <kern-dropdown [dropdownOptions]="{
                                            optionArray: filterIntegration.uniqueValuesDict[groupItem.get('name').value],
                                            buttonCaption: groupItem.get('searchValue').value,
                                            fontClass: 'font-dmMono',
                                            hasFullWidth: true
                                        }" (optionClicked)="filterIntegration.setFilterDropdownVal($event, i, 'searchValue')"></kern-dropdown>
                                        </div>
                                    </ng-template>
                                    <ng-template #searchInputs>
                                        <input *ngIf="groupItem.get('operator').value != ''"
                                            formControlName="searchValue"
                                            (keydown)="filterIntegration.checkDecimalValue($event, i)"
                                            [placeholder]="groupItem.get('addText').value"
                                            class="w-full input input-sm input-bordered placeholder-italic">

                                        <span class="text-sm text-gray-500 mx-1"
                                            *ngIf="groupItem.get('operator').value == 'BETWEEN'">AND</span>

                                        <input *ngIf="groupItem.get('operator').value == 'BETWEEN'"
                                            formControlName="searchValueBetween"
                                            [placeholder]="groupItem.get('addText').value"
                                            (keydown)="filterIntegration.checkDecimalValue($event, i)"
                                            class="w-full input input-sm input-bordered placeholder-italic">
                                    </ng-template>
                                </div>
                            </div>

                        </div>
                        <div class="w-full flex justify-center">
                            <ng-template [ngIf]="i == filterIntegration.getFilterAttributesSS().controls.length-1">
                                <label
                                    class="inline-flex items-center px-0.5 py-0.5 border border-gray-200 shadow-sm text-xs font-medium rounded text-gray-700 bg-white focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 cursor-pointer"
                                    (click)="filterIntegration.addFilterAttributesSS()">
                                    <div>
                                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none"
                                            viewBox="0 0 24 24" stroke="currentColor">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                                d="M12 4v16m8-8H4" />
                                        </svg>
                                    </div>
                                </label>
                            </ng-template>
                        </div>
                    </div>
                </ng-container>
            </div>
        </form>
    </ng-template>
</kern-modal>

<kern-modal [isOpen]="dataBrowserModals.recordComments.open" closeButton="X"
    [modalBoxStyle]="{'min-width':'25rem', 'max-width':'40rem'}"
    (optionClicked)="dataBrowserModals.recordComments.open = false">
    <h1 class="text-lg text-gray-900 mb-2 text-center">Record comments</h1>

    <div *ngFor="let cObj of dataBrowserModals.recordComments.commentsData; let i = index" class="break-words">
        <div class="flex flex-grow justify-between gap-8">
            <p style="min-width: 100px;" class="font-bold">Comment {{i+1}}</p>
            <p class="text-gray-500">{{cObj.comment}}</p>
        </div>
    </div>
</kern-modal>